<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>WIPPS: src/reader.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="Doxy.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">WIPPS
   </div>
   <div id="projectbrief">Whistler-mode Interaction Post-Processing Suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">reader.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//  reader.cpp</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//  </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//  Created by Heather Ratcliffe on 02/10/2015.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;support.h&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;reader.h&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;data_array.h&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;sdf.h&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/********Basic setup and allocation functions ****/</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="classreader.html#a9db97d91bc2ad6757407526993ec0ecf">   22</a></span>&#160;<a class="code" href="classreader.html#a9db97d91bc2ad6757407526993ec0ecf">reader::reader</a>(){</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="classreader.html#a6aa5eaef9aae20dc0987a13493e2cde7">n_chars</a> = 0;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">ref_file_num</a> = 0;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="classreader.html#a740a89098400ca57a8731f44e782dfe0">file_prefix</a> = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="classreader.html#a9dd2330bcc8bf128ffed655c876daeb3">time_range</a>[0]=0; <a class="code" href="classreader.html#a9dd2330bcc8bf128ffed655c876daeb3">time_range</a>[1]=0; <a class="code" href="classreader.html#a9dd2330bcc8bf128ffed655c876daeb3">time_range</a>[2]=0;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="classreader.html#a06e742ffce5de2afebc0d7b300b6759b">space_range</a>[0]=0; <a class="code" href="classreader.html#a06e742ffce5de2afebc0d7b300b6759b">space_range</a>[1]=1;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  memset((<span class="keywordtype">void</span> *) <a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>, 0, <a class="code" href="group__const.html#gaa1a92c9b4b7de8220956b80d25b31723">ID_SIZE</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;}</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="classreader.html#aac5cc704f9ed2c1cd576ad394b2f9f8b">   37</a></span>&#160;<a class="code" href="classreader.html#a9db97d91bc2ad6757407526993ec0ecf">reader::reader</a>(std::string file_prefix_in,  <span class="keyword">const</span> std::string block_id_in, <span class="keywordtype">int</span> ref_file_num_in){</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="comment">//Set up some generic things</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="classreader.html#a9dd2330bcc8bf128ffed655c876daeb3">time_range</a>[0]=0; <a class="code" href="classreader.html#a9dd2330bcc8bf128ffed655c876daeb3">time_range</a>[1]=0; <a class="code" href="classreader.html#a9dd2330bcc8bf128ffed655c876daeb3">time_range</a>[2]=0;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <a class="code" href="classreader.html#a06e742ffce5de2afebc0d7b300b6759b">space_range</a>[0]=0; <a class="code" href="classreader.html#a06e742ffce5de2afebc0d7b300b6759b">space_range</a>[1]=1;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  memset((<span class="keywordtype">void</span> *) <a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>, 0, <a class="code" href="group__const.html#gaa1a92c9b4b7de8220956b80d25b31723">ID_SIZE</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">//Setup the specifics</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">if</span>(block_id_in != <span class="stringliteral">&quot;&quot;</span>){</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classreader.html#a8dd8f765f99086c55ae22919fbb5fb88">is_field_block</a>(block_id_in)){</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      strncpy(this-&gt;<a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>, block_id_in.c_str(), <a class="code" href="group__const.html#gaa1a92c9b4b7de8220956b80d25b31723">ID_SIZE</a>-1);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Warning! Block name &quot;</span>+block_id_in+<span class="stringliteral">&quot; is not a field&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  }</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  this-&gt;<a class="code" href="classreader.html#a740a89098400ca57a8731f44e782dfe0">file_prefix</a> = file_prefix_in;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">//Make sure reference filenum is in valid range and setup n_chars</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  ref_file_num_in = <a class="code" href="classreader.html#a41dd448b225a620bba7677d4e625b1ff">check_file_num</a>(ref_file_num_in);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  this-&gt;<a class="code" href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">ref_file_num</a> = ref_file_num_in;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  this-&gt;<a class="code" href="classreader.html#a6aa5eaef9aae20dc0987a13493e2cde7">n_chars</a> = <a class="code" href="classreader.html#acc49b399125dbc25393515fea6c61478">get_filename_n_chars</a>(<a class="code" href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">ref_file_num</a>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">/********Filename and file manipulators ****/</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="classreader.html#a41dd448b225a620bba7677d4e625b1ff">   68</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classreader.html#a41dd448b225a620bba7677d4e625b1ff">reader::check_file_num</a>(<span class="keywordtype">int</span> file_num){</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="comment">//Stringify and count digits</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  std::string file_ref = <a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(file_num);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordtype">int</span> n_chars_first = file_ref.size();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordflow">if</span>(n_chars_first &gt; <a class="code" href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a>){</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Reference file number out of range, using 0&quot;</span>, 0, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    file_num = 0;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">return</span> file_num;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="classreader.html#acc49b399125dbc25393515fea6c61478">   85</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classreader.html#acc49b399125dbc25393515fea6c61478">reader::get_filename_n_chars</a>(<span class="keywordtype">int</span> file_num){</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  file_num = <a class="code" href="classreader.html#a41dd448b225a620bba7677d4e625b1ff">check_file_num</a>(file_num);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  std::string file_ref = <a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(file_num);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">//Pad to minimum size of 4</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordtype">int</span> digits_for_ref_num = file_ref.size();</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">if</span>(file_ref.size() &lt; 4) file_ref = std::string(4-file_ref.size(), <span class="charliteral">&#39;0&#39;</span>) + file_ref;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classreader.html#a6aa5eaef9aae20dc0987a13493e2cde7">n_chars</a> = file_ref.size();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">//Attempt to read files, inserting &#39;0&#39; padding until one can be opened or we reach MAX_FILENAME_DIGITS - digits_to_print_ref_num</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">if</span>(digits_for_ref_num &gt;= <a class="code" href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a>){</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    n_chars = <a class="code" href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Reference file number too long, max digits &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(<a class="code" href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a>), <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classreader.html#a6aa5eaef9aae20dc0987a13493e2cde7">n_chars</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  std::string name = <a class="code" href="classreader.html#a740a89098400ca57a8731f44e782dfe0">file_prefix</a> + file_ref+<span class="stringliteral">&quot;.sdf&quot;</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  std::ifstream file;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  file.open(name);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordflow">while</span>(!file.is_open()){</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    name.insert(<a class="code" href="classreader.html#a740a89098400ca57a8731f44e782dfe0">file_prefix</a>.size(), <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    file.open(name);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    n_chars ++;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span>(n_chars &gt;= <a class="code" href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a> - digits_for_ref_num) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">//Max one file can have been opened so we close it</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  file.close();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classreader.html#a6aa5eaef9aae20dc0987a13493e2cde7">n_chars</a>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;}</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">  120</a></span>&#160;std::string <a class="code" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">reader::get_full_name</a>(<span class="keywordtype">int</span> file_num){</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">//Create proper format string to zero pad filenumber</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> max_filename_places = (<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(<a class="code" href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a>)).size();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordtype">char</span> *fmt = <span class="keyword">new</span> <span class="keywordtype">char</span>[3+max_filename_places+1];</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  sprintf(fmt,<span class="stringliteral">&quot;%s%d%c&quot;</span> , <span class="stringliteral">&quot;%0&quot;</span>, <a class="code" href="classreader.html#a6aa5eaef9aae20dc0987a13493e2cde7">n_chars</a>, <span class="charliteral">&#39;d&#39;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">//Create the number string</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordtype">char</span> file_num_str[<a class="code" href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a>+1];</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  snprintf(file_num_str, <a class="code" href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a>+1, fmt, file_num);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keyword">delete</span> [] fmt;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classreader.html#a740a89098400ca57a8731f44e782dfe0">file_prefix</a> + file_num_str +<span class="stringliteral">&quot;.sdf&quot;</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="classreader.html#a7e05e99d5fb4db845f75ee7a75481363">  140</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classreader.html#a7e05e99d5fb4db845f75ee7a75481363">reader::update_ref_filenum</a>(<span class="keywordtype">int</span> num){</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  num = <a class="code" href="classreader.html#a41dd448b225a620bba7677d4e625b1ff">check_file_num</a>(num);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">if</span>(num &gt;= 0) this-&gt;<a class="code" href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">ref_file_num</a> = num;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  this-&gt;<a class="code" href="classreader.html#a6aa5eaef9aae20dc0987a13493e2cde7">n_chars</a> = <a class="code" href="classreader.html#acc49b399125dbc25393515fea6c61478">get_filename_n_chars</a>(num);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="classreader.html#a7ba20b605548a72073dfa52debc94473">  152</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classreader.html#a7ba20b605548a72073dfa52debc94473">reader::get_file_size</a>(){</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  sdf_file_t * handle;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  sdf_block_t * block;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  std::string file_name = <a class="code" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">get_full_name</a>(<a class="code" href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">ref_file_num</a>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  handle = sdf_open(file_name.c_str(), MPI_COMM_WORLD, SDF_READ, 0);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">if</span>(!handle) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  sdf_read_blocklist(handle);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  block = handle-&gt;last_block_in_file;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">int</span> sz = block-&gt;next_block_location;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  sdf_close(handle);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">return</span> sz;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">/********Block manipulators ****/</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="classreader.html#a0a4c4be70e266763e4f63f63f7f209a7">  175</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classreader.html#a0a4c4be70e266763e4f63f63f7f209a7">reader::change_block_id</a>(std::string new_id){</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">//We don&#39;t want to actually restrict to field blocks only, but we might want to allow only field or distribs if we can.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classreader.html#a8dd8f765f99086c55ae22919fbb5fb88">is_field_block</a>(new_id) || <span class="keyword">true</span>){</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    strncpy(this-&gt;<a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>, new_id.c_str(), <a class="code" href="group__const.html#gaa1a92c9b4b7de8220956b80d25b31723">ID_SIZE</a>-1);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="classreader.html#a7ba657726dd07dc169a5fa02b33812dd">  191</a></span>&#160;std::vector&lt;std::pair&lt;std::string, std::string&gt; &gt; <a class="code" href="classreader.html#a7ba657726dd07dc169a5fa02b33812dd">reader::list_blocks</a>(){</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="comment">//Open file given by ref_file_num</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  std::string file_name = <a class="code" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">get_full_name</a>(this-&gt;<a class="code" href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">ref_file_num</a>);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  sdf_file_t * handle;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  sdf_block_t * next;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  handle = sdf_open(file_name.c_str(), MPI_COMM_WORLD, SDF_READ, 0);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">//List of blocks in file</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  std::vector&lt;std::pair&lt;std::string, std::string&gt; &gt; list;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">if</span>(!handle){</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Error reading file &quot;</span>+file_name, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">return</span> list;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  sdf_read_blocklist(handle);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">//Step through blocks, recording the name and id of each</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  next = handle-&gt;current_block;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i =0; i&lt; handle-&gt;nblocks; i++){</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    list.push_back(std::make_pair(std::string(next-&gt;name), std::string(next-&gt;id)));</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    next = next-&gt;next;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  sdf_close(handle);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordflow">return</span> list;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;}</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="classreader.html#a375a0c31265151bf2e774ac077f44db4">  223</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classreader.html#a375a0c31265151bf2e774ac077f44db4">reader::has_accum_data</a>(){</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  std::string file_name = <a class="code" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">get_full_name</a>(<a class="code" href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">ref_file_num</a>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <a class="code" href="group__help.html#gab561211b55f0a58d07961cf05e256e06">my_print</a>(<span class="stringliteral">&quot;Checking for accumulated variables&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  sdf_file_t *handle = sdf_open(file_name.c_str(), MPI_COMM_WORLD, SDF_READ, 0);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">bool</span> has_accum = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">//Step through blocks, checking each using is_accum function</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">if</span>(handle){</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    sdf_read_blocklist(handle);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    sdf_block_t * next = handle-&gt;current_block;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; handle-&gt;nblocks; i++){</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classreader.html#af17226df8747ac3acb7ca1ee20349372">is_accum</a>(std::string(next-&gt;id))){</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        has_accum = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      next = next-&gt;next;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    sdf_close(handle);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">return</span> has_accum;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="classreader.html#acf280eabc3613aa967b9f55728fc9038">  250</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classreader.html#acf280eabc3613aa967b9f55728fc9038">reader::current_block_is_accum</a>(){</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classreader.html#af17226df8747ac3acb7ca1ee20349372">is_accum</a>(this-&gt;<a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="classreader.html#a8dd8f765f99086c55ae22919fbb5fb88">  259</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classreader.html#a8dd8f765f99086c55ae22919fbb5fb88">reader::is_field_block</a>(std::string block_id){</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">if</span>(block_id == <span class="stringliteral">&quot;ex&quot;</span> || block_id ==<span class="stringliteral">&quot;ey&quot;</span> || block_id ==<span class="stringliteral">&quot;ez&quot;</span> || block_id ==<span class="stringliteral">&quot;bx&quot;</span> || block_id ==<span class="stringliteral">&quot;by&quot;</span> || block_id ==<span class="stringliteral">&quot;bz&quot;</span>) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classreader.html#af17226df8747ac3acb7ca1ee20349372">is_accum</a>(block_id)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno"><a class="line" href="classreader.html#af17226df8747ac3acb7ca1ee20349372">  272</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classreader.html#af17226df8747ac3acb7ca1ee20349372">reader::is_accum</a>(std::string block_id){</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">if</span>(block_id == <span class="stringliteral">&quot;ax&quot;</span> || block_id ==<span class="stringliteral">&quot;ay&quot;</span> || block_id ==<span class="stringliteral">&quot;az&quot;</span> || block_id ==<span class="stringliteral">&quot;abx&quot;</span> || block_id ==<span class="stringliteral">&quot;aby&quot;</span> || block_id ==<span class="stringliteral">&quot;abz&quot;</span>) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">/********File read routines ****/</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="classreader.html#a8a4bda5f5681c1071bed26f0827c1e6c">  287</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classreader.html#a8a4bda5f5681c1071bed26f0827c1e6c">reader::pre_read</a>(<a class="code" href="classdata__array.html">data_array</a>&amp; data_in, <span class="keywordtype">int</span> ref_time, <span class="keywordtype">bool</span> accumulated, <span class="keywordtype">int</span> flatten_on, <span class="keywordtype">size_t</span> &amp;n_dims, <span class="keywordtype">size_t</span> * &amp;source_sizes){</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  sdf_file_t * handle;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  sdf_block_t * block;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordtype">size_t</span> len;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  std::string file_name = <a class="code" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">get_full_name</a>(ref_time);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  handle = sdf_open(file_name.c_str(), MPI_COMM_WORLD, SDF_READ, 0);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordflow">if</span>(!handle) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  sdf_read_blocklist(handle);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">//Locate correct grids block by name</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  std::string grid_name = <span class="stringliteral">&quot;grid&quot;</span>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">if</span>(accumulated) grid_name = <span class="stringliteral">&quot;grid_accum&quot;</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  block = sdf_find_block_by_id(handle, grid_name.c_str());</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  handle-&gt;current_block = block;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">//Checks type is plain i.e. an even-gridded mesh</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">if</span>(block-&gt;blocktype != SDF_BLOCKTYPE_PLAIN_MESH){</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Uh oh, grids look wrong&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  sdf_read_data(handle);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordflow">if</span>(block-&gt;datatype != <a class="code" href="group__type.html#ga8ba59e5669a9038d6b106eaaff909b1c">my_sdf_type</a>){</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Wrong data type detected. Converting grids&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);<span class="comment">//Print a warning about needing to type-convert</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">//Copy (all) the spatial axes, skipping a flattening dim if one exists</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0, i2=0; i&lt; data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()-1; i++, i2++){</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span>(flatten_on &gt;= 0 &amp;&amp; (<span class="keywordtype">size_t</span>)flatten_on == i){</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      i2++;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    len = data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(i);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span>(block-&gt;datatype != <a class="code" href="group__type.html#ga8ba59e5669a9038d6b106eaaff909b1c">my_sdf_type</a>){</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="comment">//Start of grid for this dimension, mapped to correct type</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <a class="code" href="group__type.html#ga4c7bcf75c6cafd0930b6eb255c309560">other_type</a> * grid_start = (<a class="code" href="group__type.html#ga4c7bcf75c6cafd0930b6eb255c309560">other_type</a> *) block-&gt;grids[i2];</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; len; j++){</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        data_in.<a class="code" href="classdata__array.html#abb2a53c03db08014b2b97605a3ad4562">set_axis_element</a>(i, j, grid_start[j]);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> * grid_start = (<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> *) block-&gt;grids[i2];</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; len; j++){</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        data_in.<a class="code" href="classdata__array.html#abb2a53c03db08014b2b97605a3ad4562">set_axis_element</a>(i, j, grid_start[j]);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">//Now we get the *spatial* input sizes</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  n_dims = block-&gt;ndims - accumulated;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  source_sizes = (<span class="keywordtype">size_t</span> *) malloc(n_dims*<span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>));</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt; n_dims; i++){</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">//Size of data source. Note -1 because we&#39;re doing this from the grid block sizes which have ghost cells</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    source_sizes[i] = block-&gt;dims[i]-1;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  sdf_close(handle);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno"><a class="line" href="classreader.html#a63c828f7e7e16c374fb6460a1f9ba2bc">  360</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classreader.html#a63c828f7e7e16c374fb6460a1f9ba2bc">reader::read_plain_time</a>(<a class="code" href="classdata__array.html">data_array</a>&amp; data_in, sdf_file_t *handle, <span class="keywordtype">size_t</span> pos){</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">//Time is always last dimension</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  data_in.<a class="code" href="classdata__array.html#abb2a53c03db08014b2b97605a3ad4562">set_axis_element</a>(data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()-1, pos, (<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a>) handle-&gt;time);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="classreader.html#aaca801456eb44ca4cfd7ca33068698cf">  373</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classreader.html#aaca801456eb44ca4cfd7ca33068698cf">reader::read_acc_time</a>(<a class="code" href="classdata__array.html">data_array</a> &amp; data_in, sdf_file_t * handle, <span class="keywordtype">size_t</span> start_pos, <span class="keywordtype">size_t</span> n_times){</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  sdf_block_t * ax_block = sdf_find_block_by_id(handle, <span class="stringliteral">&quot;grid_accum&quot;</span>);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  handle-&gt;current_block = ax_block;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  sdf_read_data(handle);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordtype">size_t</span> time_dim = data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()-1, n_grids = ax_block-&gt;ndims;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">//Copy time grid from ax_block into dat_in.axes</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordflow">if</span>(data_in.<a class="code" href="classdata__array.html#addf2c1b94dff445a2e7ca4a3cc258ea0">is_good</a>()){</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">if</span>(ax_block-&gt;datatype != <a class="code" href="group__type.html#ga8ba59e5669a9038d6b106eaaff909b1c">my_sdf_type</a>){</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="comment">//Start of grid for this dimension, mapped to correct type</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <a class="code" href="group__type.html#ga4c7bcf75c6cafd0930b6eb255c309560">other_type</a> * grid_start = (<a class="code" href="group__type.html#ga4c7bcf75c6cafd0930b6eb255c309560">other_type</a> *) ax_block-&gt;grids[n_grids-1];</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; n_times; j++){</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        data_in.<a class="code" href="classdata__array.html#abb2a53c03db08014b2b97605a3ad4562">set_axis_element</a>(time_dim, start_pos+j, grid_start[j]);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> * grid_start = (<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> *) ax_block-&gt;grids[n_grids-1];</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; n_times; j++){</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        data_in.<a class="code" href="classdata__array.html#abb2a53c03db08014b2b97605a3ad4562">set_axis_element</a>(time_dim, start_pos+j, grid_start[j]);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno"><a class="line" href="classreader.html#a2110381d3a8b2a4bb475a36b0a9fc259">  404</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classreader.html#a2110381d3a8b2a4bb475a36b0a9fc259">reader::read_dims</a>(<span class="keywordtype">size_t</span> &amp;n_dims, std::vector&lt;size_t&gt; &amp;dims){</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classreader.html#a2110381d3a8b2a4bb475a36b0a9fc259">read_dims</a>(n_dims, dims, std::string(this-&gt;<a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>));</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;}</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno"><a class="line" href="classreader.html#aad0bfdfa0a7ba5b3dcd885671a783f97">  413</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classreader.html#a2110381d3a8b2a4bb475a36b0a9fc259">reader::read_dims</a>(<span class="keywordtype">size_t</span> &amp;n_dims, std::vector&lt;size_t&gt; &amp;dims, std::string b_id){</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">//Open file</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  std::string file_name = <a class="code" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">get_full_name</a>(<a class="code" href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">ref_file_num</a>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <a class="code" href="group__help.html#gab561211b55f0a58d07961cf05e256e06">my_print</a>(<span class="stringliteral">&quot;Getting dimensions&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  sdf_file_t *handle = sdf_open(file_name.c_str(), MPI_COMM_WORLD, SDF_READ, 0);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  sdf_block_t * block;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordflow">if</span>(!handle){</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;File open error &quot;</span>+file_name, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">if</span>(b_id ==<span class="stringliteral">&quot;&quot;</span>){</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;No block name specified&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="comment">//Attempt to locate block</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordtype">bool</span> err=sdf_read_blocklist(handle);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">if</span>(err){</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Block read failed&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  block = sdf_find_block_by_id(handle, b_id.c_str());</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">if</span>(!block){</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Requested block not found&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="classreader.html#af17226df8747ac3acb7ca1ee20349372">is_accum</a>(b_id)){</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    n_dims = block-&gt;ndims;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    n_dims = block-&gt;ndims -1 ;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">//remove time dimension from accum. blocks</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="comment">//Copy the dimensions, omitting time if block is accumulated</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;n_dims; i++) dims.push_back(block-&gt;dims[i]);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  sdf_close(handle);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;}</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="classreader.html#a74a42ddc95d153296836e4266894a4b8">  465</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classreader.html#a74a42ddc95d153296836e4266894a4b8">reader::read_data</a>(<a class="code" href="classdata__array.html">data_array</a> &amp;my_data_in, <span class="keywordtype">size_t</span> time_range[3], <span class="keywordtype">size_t</span> space_range[2], <span class="keywordtype">int</span> flatten_on){</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordflow">if</span>(!my_data_in.<a class="code" href="classdata__array.html#addf2c1b94dff445a2e7ca4a3cc258ea0">is_good</a>()){</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Cannot read into invalid array&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>[0] ==<span class="charliteral">&#39; &#39;</span>){</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Invalid or no block name specified&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  }</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">//Set block id</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  strcpy(my_data_in.<a class="code" href="classdata__array.html#a3d0ef71b166616bb19a7084cab1f0945">block_id</a>, <a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  sdf_file_t * handle;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  sdf_block_t * block;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  std::string file_name;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordtype">bool</span> accumulated = <a class="code" href="classreader.html#af17226df8747ac3acb7ca1ee20349372">is_accum</a>(<a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keywordflow">if</span>(flatten_on &gt;= (<span class="keywordtype">int</span>) my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()){</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="group__help.html#gab561211b55f0a58d07961cf05e256e06">my_print</a>(<span class="stringliteral">&quot;Flatten dimension exceeds array size. No flattening will occur&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    flatten_on = -1;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordtype">size_t</span> grid_n_dims;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordtype">size_t</span> * source_sizes = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordtype">int</span> err = <a class="code" href="classreader.html#a8a4bda5f5681c1071bed26f0827c1e6c">pre_read</a>(my_data_in, time_range[0], accumulated, flatten_on, grid_n_dims, source_sizes);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="comment">//Do the pre-read loops stuff, like grids and size getting</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordflow">if</span>(err) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="comment">//Check spatial dims match sliced size. Don&#39;t check time since we might end up truncating</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="comment">//Check 0th dim separately in case of slicing</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keywordflow">if</span>(my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(0) != space_range[1]-space_range[0]) err += 1;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt; my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()-1; i++)  <span class="keywordflow">if</span>(my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(i) != source_sizes[i]) err += 1;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">if</span>(err &gt; 0){</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Source sizes do not match given array. Aborting read&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordtype">bool</span> simple_slice = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordtype">int</span> source_advance = 1;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">//Simple slices are those where we&#39;re slicing only the last spatial dimension, so we can just stop the read early. Since we only slice in x, that means either one and only one spatial dim, or no slicing.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  simple_slice = (my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>() ==2 || source_sizes[0] == space_range[1]-space_range[0]);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="comment">//Get SPACE advance for source, i.e advance between one time read and the next</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt; grid_n_dims; i++){</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    source_advance *= source_sizes[i];</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">//If we have to flatten, we need somewhere to put the flat data</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> * flat_data = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">if</span>(flatten_on &gt;=0){</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    flat_data = (<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a>)*source_advance);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordtype">size_t</span> i;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordtype">size_t</span> last_report = 0;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordtype">size_t</span> report_interval = (time_range[1]-time_range[0])/10;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">if</span>(report_interval &gt; 20) report_interval = 20;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">if</span>(report_interval &lt; 1) report_interval = 1;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">//Say we want to report 10 times over the list, or every 20th file if  more than 200.</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  my_data_in.<a class="code" href="classdata__array.html#a19a419682c61feea8f25c9c3a2e7f180">space</a>[0] = space_range[0];</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  my_data_in.<a class="code" href="classdata__array.html#a19a419682c61feea8f25c9c3a2e7f180">space</a>[1] = space_range[1];</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordtype">size_t</span> rows = 0; <span class="comment">//Accumulated blocks only: number of rows to read in current file</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordtype">size_t</span> total_reads = 0; <span class="comment">//Current number of reads done</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordtype">size_t</span> max_rows = my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()-1), max_rows_acc = max_rows; <span class="comment">//The max number of rows to attempt to read for plain or accumulated blocks respectively</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">//Accumulated blocks contain &gt;=1 line per file so we never access more files than there are rows in my_data_in</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">if</span>(max_rows &gt; time_range[1] - time_range[0]) max_rows = time_range[1] - time_range[0]; <span class="comment">//Plain blocks: min of requested number and the array size</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keywordflow">if</span>(max_rows_acc &gt; time_range[2]) max_rows_acc = time_range[2]; <span class="comment">//Accum blocks: min of requested number and the array size, but can do less if there&#39;s insufficient files</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="comment">//Now loop over files getting data and time info</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordflow">for</span>(i = time_range[0]; i &lt; time_range[0] + max_rows;++i){</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    file_name = <a class="code" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">get_full_name</a>(i);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span>((i-last_report) &gt;= report_interval){</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <a class="code" href="group__help.html#gab561211b55f0a58d07961cf05e256e06">my_print</a>(<span class="stringliteral">&quot;Opening &quot;</span> + file_name, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      last_report = i;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    handle = sdf_open(file_name.c_str(), MPI_COMM_WORLD, SDF_READ, 0);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">if</span>(!handle) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    sdf_read_blocklist(handle);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    block = sdf_find_block_by_id(handle, this-&gt;<a class="code" href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">block_id</a>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span>(!block) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    handle-&gt;current_block = block;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    sdf_read_data(handle);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span>(block-&gt;datatype != <a class="code" href="group__type.html#ga8ba59e5669a9038d6b106eaaff909b1c">my_sdf_type</a>) <a class="code" href="group__help.html#gab561211b55f0a58d07961cf05e256e06">my_print</a>(<span class="stringliteral">&quot;WARNING!!! Data type does not match. Output may be nonsense!&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">if</span>(!block-&gt;data) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> * my_ptr = (<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> *) block-&gt;data;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">//Move on to the correct 0th dim starting location</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    my_ptr += source_advance/block-&gt;dims[0]*space_range[0];</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">if</span>(!accumulated){</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keywordtype">size_t</span> val[1];</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      val[0] = i-time_range[0];</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <a class="code" href="classreader.html#a63c828f7e7e16c374fb6460a1f9ba2bc">read_plain_time</a>(my_data_in, handle, val[0]);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">if</span>(simple_slice &amp;&amp; flatten_on &lt; 0){</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="comment">//Simple slicing and no flattening required</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        my_data_in.<a class="code" href="classmy__array.html#ae527e9d9d3dfabcf78ec2c29229b2687">populate_slice</a>(my_ptr, 1, val);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(simple_slice){</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="comment">//Simple slicing but we flatten first</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <a class="code" href="group__main.html#gaa14888495f473b62cbeee423d2ebc8a2">flatten_fortran_slice</a>(my_ptr, flat_data, my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()-1, source_sizes,flatten_on);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        my_data_in.<a class="code" href="classmy__array.html#ae527e9d9d3dfabcf78ec2c29229b2687">populate_slice</a>(flat_data, 1, val);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="comment">//Complicated slicing, this is UNTESTED</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        my_data_in.<a class="code" href="classmy__array.html#a8597ed17c70b4e8a33e7e5784b962afb">populate_complex_slice</a>(my_ptr, 1, val, source_sizes);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="comment">//One time has been read</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      total_reads++;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="comment">//Read all rows in file, but not more than time[2] rows total</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      rows = block-&gt;dims[block-&gt;ndims-1];</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="keywordflow">if</span>(total_reads + rows &gt;= max_rows_acc) rows = max_rows_acc - total_reads;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <a class="code" href="classreader.html#aaca801456eb44ca4cfd7ca33068698cf">read_acc_time</a>(my_data_in, handle, total_reads, rows);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keywordtype">size_t</span> val[1] = {total_reads};</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="comment">//Handle each row in turn for simplicity</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j=0; j&lt;rows; j++){</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">if</span>(simple_slice &amp;&amp; flatten_on &lt; 0){</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          my_data_in.<a class="code" href="classmy__array.html#ae527e9d9d3dfabcf78ec2c29229b2687">populate_slice</a>(my_ptr, 1, val);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(simple_slice){</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          <span class="comment">//Simple slicing but we flatten first</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          <a class="code" href="group__main.html#gaa14888495f473b62cbeee423d2ebc8a2">flatten_fortran_slice</a>(my_ptr, flat_data, my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()-1, source_sizes,flatten_on);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          my_data_in.<a class="code" href="classmy__array.html#ae527e9d9d3dfabcf78ec2c29229b2687">populate_slice</a>(flat_data, 1, val);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          my_data_in.<a class="code" href="classmy__array.html#a8597ed17c70b4e8a33e7e5784b962afb">populate_complex_slice</a>(my_ptr, 1, val, source_sizes);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="comment">//Update row to fill</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        val[0] ++;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="comment">//Update position in data file by correct amount</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        my_ptr += source_advance;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="comment">//&quot;Rows&quot; times have been read</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      total_reads+= rows;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    sdf_close(handle);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">//Stop after time_range[2] total reads for accumulated data</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">if</span>(accumulated &amp;&amp; total_reads &gt;= max_rows_acc) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="comment">//If we did flattening, what we actually want is the average not the total</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordflow">if</span>(flatten_on &gt;= 0){</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    my_data_in.<a class="code" href="classmy__array.html#a5a3635f556b2c4beb8056732ac30410a">apply</a>(<a class="code" href="group__aux__fns.html#gaf0853507ccf332d6e804fd681fa59ecd">divide</a>, source_sizes[flatten_on]);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">if</span>(source_sizes) free(source_sizes);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">if</span>(flat_data) free(flat_data);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">//Set 0th time</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordtype">size_t</span> n_dims = my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>();</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  my_data_in.<a class="code" href="classdata__array.html#a33b8978a530070319dd4d06de62ca64d">time</a>[0] = my_data_in.<a class="code" href="classdata__array.html#af49ab90a1084127c61a9e1ef48145530">get_axis_element</a>(n_dims-1, 0);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="comment">//report if we broke out of loop and print info</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordflow">if</span>((!accumulated &amp;&amp; (i &lt; time_range[1] || i &lt; my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(0))) || (accumulated &amp;&amp; (total_reads &lt; time_range[2] || total_reads &lt; my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(0) ))){</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">//Trim array to match number of lines actually read</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">size_t</span> orig_n_tims = my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>()-1);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    my_data_in.<a class="code" href="classdata__array.html#ae64edd84458176558b1c3d39853d5d7e">resize</a>(n_dims-1, total_reads);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">//Set last time, note we just resized the axis</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    my_data_in.<a class="code" href="classdata__array.html#a33b8978a530070319dd4d06de62ca64d">time</a>[1] = my_data_in.<a class="code" href="classdata__array.html#af49ab90a1084127c61a9e1ef48145530">get_axis_element</a>(n_dims-1, my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(n_dims-1)-1);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    std::string exit_reason;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">if</span>(!accumulated &amp;&amp; (total_reads &lt; orig_n_tims)){</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">//Must have run out of files to read</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      exit_reason = <span class="stringliteral">&quot;out of files&quot;</span>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(!accumulated){</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="comment">//Array must be filled</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      exit_reason = <span class="stringliteral">&quot;array full&quot;</span>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(accumulated &amp;&amp; (total_reads &lt; time_range[2]) &amp;&amp; (i &lt; time_range[1])){</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="comment">//Array must be full</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      exit_reason = <span class="stringliteral">&quot;array full&quot;</span>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(accumulated &amp;&amp; (total_reads &lt; time_range[2])){</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="comment">//Run out of files but haven&#39;t read all rows</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      exit_reason = <span class="stringliteral">&quot;out of files&quot;</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="comment">//Out of rows</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      exit_reason = <span class="stringliteral">&quot;requested rows read&quot;</span>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Read stopped at file &quot;</span>+file_name + <span class="stringliteral">&quot; (&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(total_reads)+<span class="stringliteral">&quot; times), &quot;</span>+exit_reason, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">return</span> 2;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="comment">//Set last time</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    my_data_in.<a class="code" href="classdata__array.html#a33b8978a530070319dd4d06de62ca64d">time</a>[1] = my_data_in.<a class="code" href="classdata__array.html#af49ab90a1084127c61a9e1ef48145530">get_axis_element</a>(n_dims-1, my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(n_dims-1)-1);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <a class="code" href="group__help.html#gab561211b55f0a58d07961cf05e256e06">my_print</a>(<span class="stringliteral">&quot;Read &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(total_reads)+<span class="stringliteral">&quot; times&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;}</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno"><a class="line" href="classreader.html#ab6e97fcd45da817cf0af51bc38c44b70">  675</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classreader.html#ab6e97fcd45da817cf0af51bc38c44b70">reader::read_distrib</a>(<a class="code" href="classdata__array.html">data_array</a> &amp; my_data_in, std::string dist_id, <span class="keywordtype">int</span> dump_number){</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">if</span>(!my_data_in.<a class="code" href="classdata__array.html#addf2c1b94dff445a2e7ca4a3cc258ea0">is_good</a>()){</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Cannot read into invalid array&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  sdf_file_t * handle;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  sdf_block_t * block;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  std::string file_name = <a class="code" href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">get_full_name</a>(dump_number);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  handle = sdf_open(file_name.c_str(), MPI_COMM_WORLD, SDF_READ, 0);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">if</span>(!handle) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  sdf_read_blocklist(handle);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  block = sdf_find_block_by_id(handle, dist_id.c_str());</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">if</span>(!block) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  handle-&gt;current_block = block;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  sdf_read_data(handle);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordflow">if</span>(!block-&gt;data) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="comment">//Copy the data, converting if necessary</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordtype">size_t</span> total_els = my_data_in.<a class="code" href="classmy__array.html#a4749153167d44907a552b37b6934a92e">get_total_elements</a>();</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordflow">if</span>(block-&gt;datatype != <a class="code" href="group__type.html#ga8ba59e5669a9038d6b106eaaff909b1c">my_sdf_type</a>) my_data_in.<a class="code" href="classmy__array.html#abc6666203ecd7e742e2e9902d42ee10a">populate_data</a>((<a class="code" href="group__type.html#ga4c7bcf75c6cafd0930b6eb255c309560">other_type</a>*)block-&gt;data, total_els);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">else</span> my_data_in.<a class="code" href="classmy__array.html#abc6666203ecd7e742e2e9902d42ee10a">populate_data</a>((<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a>*)block-&gt;data, total_els);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="comment">//Copy the other info</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  strncpy(my_data_in.<a class="code" href="classdata__array.html#a3d0ef71b166616bb19a7084cab1f0945">block_id</a>, dist_id.c_str(), <a class="code" href="group__const.html#gaa1a92c9b4b7de8220956b80d25b31723">ID_SIZE</a>-1);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  my_data_in.<a class="code" href="classdata__array.html#a33b8978a530070319dd4d06de62ca64d">time</a>[0] = handle-&gt;time;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  my_data_in.<a class="code" href="classdata__array.html#a33b8978a530070319dd4d06de62ca64d">time</a>[1] = handle-&gt;time;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="comment">//Finally read the axes</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  block = sdf_find_block_by_id(handle, (<span class="stringliteral">&quot;grid/&quot;</span>+dist_id).c_str());</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordflow">if</span>(!block) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  handle-&gt;current_block = block;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  sdf_read_data(handle);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordtype">size_t</span> len;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt; my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(); i++){</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    len = my_data_in.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(i);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">if</span>(block-&gt;datatype != <a class="code" href="group__type.html#ga8ba59e5669a9038d6b106eaaff909b1c">my_sdf_type</a>){</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="comment">//Start of grid for this dimension, mapped to correct type</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <a class="code" href="group__type.html#ga4c7bcf75c6cafd0930b6eb255c309560">other_type</a> * grid_start = (<a class="code" href="group__type.html#ga4c7bcf75c6cafd0930b6eb255c309560">other_type</a> *) block-&gt;grids[i];</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; len; j++){</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        my_data_in.<a class="code" href="classdata__array.html#abb2a53c03db08014b2b97605a3ad4562">set_axis_element</a>(i, j, grid_start[j]);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> * grid_start = (<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> *) block-&gt;grids[i];</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; len; j++){</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        my_data_in.<a class="code" href="classdata__array.html#abb2a53c03db08014b2b97605a3ad4562">set_axis_element</a>(i, j, grid_start[j]);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      }</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    }</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;}</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="ttc" id="group__main_html_gaa14888495f473b62cbeee423d2ebc8a2"><div class="ttname"><a href="group__main.html#gaa14888495f473b62cbeee423d2ebc8a2">flatten_fortran_slice</a></div><div class="ttdeci">bool flatten_fortran_slice(my_type *src_ptr, my_type *dest_ptr, size_t n_dims_in, size_t *dims_in, size_t flatten_on_dim, size_t flat_start, size_t flat_stop)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00546">support.cpp:546</a></div></div>
<div class="ttc" id="classreader_html_acc49b399125dbc25393515fea6c61478"><div class="ttname"><a href="classreader.html#acc49b399125dbc25393515fea6c61478">reader::get_filename_n_chars</a></div><div class="ttdeci">int get_filename_n_chars(int file_num)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00085">reader.cpp:85</a></div></div>
<div class="ttc" id="classdata__array_html_af49ab90a1084127c61a9e1ef48145530"><div class="ttname"><a href="classdata__array.html#af49ab90a1084127c61a9e1ef48145530">data_array::get_axis_element</a></div><div class="ttdeci">my_type get_axis_element(size_t dim, size_t pt) const </div><div class="ttdef"><b>Definition:</b> <a href="data__array_8cpp_source.html#l00392">data_array.cpp:392</a></div></div>
<div class="ttc" id="classreader_html_a7ba20b605548a72073dfa52debc94473"><div class="ttname"><a href="classreader.html#a7ba20b605548a72073dfa52debc94473">reader::get_file_size</a></div><div class="ttdeci">int get_file_size()</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00152">reader.cpp:152</a></div></div>
<div class="ttc" id="classmy__array_html_a8597ed17c70b4e8a33e7e5784b962afb"><div class="ttname"><a href="classmy__array.html#a8597ed17c70b4e8a33e7e5784b962afb">my_array::populate_complex_slice</a></div><div class="ttdeci">bool populate_complex_slice(my_type *dat_in, size_t n_dims, size_t *offsets, size_t *sizes)</div><div class="ttdef"><b>Definition:</b> <a href="my__array_8cpp_source.html#l00608">my_array.cpp:608</a></div></div>
<div class="ttc" id="group__type_html_ga0f3d3a6e2c07b43705a3b4c4060c9d5b"><div class="ttname"><a href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a></div><div class="ttdeci">#define my_type</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00031">support.h:31</a></div></div>
<div class="ttc" id="group__const_html_ga115a05fc1c5ed7f428c9d45a64997cfb"><div class="ttname"><a href="group__const.html#ga115a05fc1c5ed7f428c9d45a64997cfb">MAX_FILENAME_DIGITS</a></div><div class="ttdeci">const int MAX_FILENAME_DIGITS</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00066">support.h:66</a></div></div>
<div class="ttc" id="structmpi__info__struc_html_a8cfcb8992c29a52fe32b370b0d10e46b"><div class="ttname"><a href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">mpi_info_struc::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00152">support.h:152</a></div></div>
<div class="ttc" id="classreader_html_a990ffc2ea390f5d33e9858adf73b6242"><div class="ttname"><a href="classreader.html#a990ffc2ea390f5d33e9858adf73b6242">reader::ref_file_num</a></div><div class="ttdeci">int ref_file_num</div><div class="ttdef"><b>Definition:</b> <a href="reader_8h_source.html#l00028">reader.h:28</a></div></div>
<div class="ttc" id="classreader_html_a8a4bda5f5681c1071bed26f0827c1e6c"><div class="ttname"><a href="classreader.html#a8a4bda5f5681c1071bed26f0827c1e6c">reader::pre_read</a></div><div class="ttdeci">int pre_read(data_array &amp;data_in, int ref_time, bool accumulated, int flatten_on, size_t &amp;n_dims, size_t *&amp;source_sizes)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00287">reader.cpp:287</a></div></div>
<div class="ttc" id="classreader_html_a8dd8f765f99086c55ae22919fbb5fb88"><div class="ttname"><a href="classreader.html#a8dd8f765f99086c55ae22919fbb5fb88">reader::is_field_block</a></div><div class="ttdeci">bool is_field_block(std::string block_id)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00259">reader.cpp:259</a></div></div>
<div class="ttc" id="classreader_html_abf4ffbeab2afff0279be7e9e06c40eb1"><div class="ttname"><a href="classreader.html#abf4ffbeab2afff0279be7e9e06c40eb1">reader::block_id</a></div><div class="ttdeci">char block_id[ID_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="reader_8h_source.html#l00048">reader.h:48</a></div></div>
<div class="ttc" id="classreader_html_aaca801456eb44ca4cfd7ca33068698cf"><div class="ttname"><a href="classreader.html#aaca801456eb44ca4cfd7ca33068698cf">reader::read_acc_time</a></div><div class="ttdeci">void read_acc_time(data_array &amp;data_in, sdf_file_t *handle, size_t start_pos, size_t n_times)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00373">reader.cpp:373</a></div></div>
<div class="ttc" id="group__aux__fns_html_gaf0853507ccf332d6e804fd681fa59ecd"><div class="ttname"><a href="group__aux__fns.html#gaf0853507ccf332d6e804fd681fa59ecd">divide</a></div><div class="ttdeci">my_type divide(my_type lhs, my_type rhs)</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00331">support.h:331</a></div></div>
<div class="ttc" id="classreader_html_a63c828f7e7e16c374fb6460a1f9ba2bc"><div class="ttname"><a href="classreader.html#a63c828f7e7e16c374fb6460a1f9ba2bc">reader::read_plain_time</a></div><div class="ttdeci">void read_plain_time(data_array &amp;data_in, sdf_file_t *handle, size_t pos)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00360">reader.cpp:360</a></div></div>
<div class="ttc" id="classmy__array_html_a4749153167d44907a552b37b6934a92e"><div class="ttname"><a href="classmy__array.html#a4749153167d44907a552b37b6934a92e">my_array::get_total_elements</a></div><div class="ttdeci">size_t get_total_elements() const </div><div class="ttdef"><b>Definition:</b> <a href="my__array_8cpp_source.html#l00478">my_array.cpp:478</a></div></div>
<div class="ttc" id="classreader_html_a9db97d91bc2ad6757407526993ec0ecf"><div class="ttname"><a href="classreader.html#a9db97d91bc2ad6757407526993ec0ecf">reader::reader</a></div><div class="ttdeci">reader()</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00022">reader.cpp:22</a></div></div>
<div class="ttc" id="classreader_html_a740a89098400ca57a8731f44e782dfe0"><div class="ttname"><a href="classreader.html#a740a89098400ca57a8731f44e782dfe0">reader::file_prefix</a></div><div class="ttdeci">std::string file_prefix</div><div class="ttdef"><b>Definition:</b> <a href="reader_8h_source.html#l00045">reader.h:45</a></div></div>
<div class="ttc" id="classdata__array_html_a19a419682c61feea8f25c9c3a2e7f180"><div class="ttname"><a href="classdata__array.html#a19a419682c61feea8f25c9c3a2e7f180">data_array::space</a></div><div class="ttdeci">size_t space[2]</div><div class="ttdef"><b>Definition:</b> <a href="data__array_8h_source.html#l00043">data_array.h:43</a></div></div>
<div class="ttc" id="group__type_html_ga8ba59e5669a9038d6b106eaaff909b1c"><div class="ttname"><a href="group__type.html#ga8ba59e5669a9038d6b106eaaff909b1c">my_sdf_type</a></div><div class="ttdeci">#define my_sdf_type</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00033">support.h:33</a></div></div>
<div class="ttc" id="classmy__array_html_a5a3635f556b2c4beb8056732ac30410a"><div class="ttname"><a href="classmy__array.html#a5a3635f556b2c4beb8056732ac30410a">my_array::apply</a></div><div class="ttdeci">void apply(std::function&lt; my_type(my_type arg)&gt; func)</div><div class="ttdef"><b>Definition:</b> <a href="my__array_8h_source.html#l00114">my_array.h:114</a></div></div>
<div class="ttc" id="classreader_html_a375a0c31265151bf2e774ac077f44db4"><div class="ttname"><a href="classreader.html#a375a0c31265151bf2e774ac077f44db4">reader::has_accum_data</a></div><div class="ttdeci">bool has_accum_data()</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00223">reader.cpp:223</a></div></div>
<div class="ttc" id="classreader_html_a9dd2330bcc8bf128ffed655c876daeb3"><div class="ttname"><a href="classreader.html#a9dd2330bcc8bf128ffed655c876daeb3">reader::time_range</a></div><div class="ttdeci">int time_range[3]</div><div class="ttdef"><b>Definition:</b> <a href="reader_8h_source.html#l00047">reader.h:47</a></div></div>
<div class="ttc" id="classdata__array_html_ae64edd84458176558b1c3d39853d5d7e"><div class="ttname"><a href="classdata__array.html#ae64edd84458176558b1c3d39853d5d7e">data_array::resize</a></div><div class="ttdeci">bool resize(size_t dim, size_t sz, bool verbose=0)</div><div class="ttdef"><b>Definition:</b> <a href="data__array_8cpp_source.html#l00728">data_array.cpp:728</a></div></div>
<div class="ttc" id="classreader_html_a7ba657726dd07dc169a5fa02b33812dd"><div class="ttname"><a href="classreader.html#a7ba657726dd07dc169a5fa02b33812dd">reader::list_blocks</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; std::string, std::string &gt; &gt; list_blocks()</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00191">reader.cpp:191</a></div></div>
<div class="ttc" id="classdata__array_html_abb2a53c03db08014b2b97605a3ad4562"><div class="ttname"><a href="classdata__array.html#abb2a53c03db08014b2b97605a3ad4562">data_array::set_axis_element</a></div><div class="ttdeci">bool set_axis_element(size_t dim, size_t pt, my_type val)</div><div class="ttdef"><b>Definition:</b> <a href="data__array_8cpp_source.html#l00410">data_array.cpp:410</a></div></div>
<div class="ttc" id="classreader_html_ab6e97fcd45da817cf0af51bc38c44b70"><div class="ttname"><a href="classreader.html#ab6e97fcd45da817cf0af51bc38c44b70">reader::read_distrib</a></div><div class="ttdeci">bool read_distrib(data_array &amp;my_data_in, std::string dist_id, int dump_number)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00675">reader.cpp:675</a></div></div>
<div class="ttc" id="classreader_html_a6aa5eaef9aae20dc0987a13493e2cde7"><div class="ttname"><a href="classreader.html#a6aa5eaef9aae20dc0987a13493e2cde7">reader::n_chars</a></div><div class="ttdeci">int n_chars</div><div class="ttdef"><b>Definition:</b> <a href="reader_8h_source.html#l00027">reader.h:27</a></div></div>
<div class="ttc" id="group__type_html_ga4c7bcf75c6cafd0930b6eb255c309560"><div class="ttname"><a href="group__type.html#ga4c7bcf75c6cafd0930b6eb255c309560">other_type</a></div><div class="ttdeci">#define other_type</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00032">support.h:32</a></div></div>
<div class="ttc" id="classreader_html_acf280eabc3613aa967b9f55728fc9038"><div class="ttname"><a href="classreader.html#acf280eabc3613aa967b9f55728fc9038">reader::current_block_is_accum</a></div><div class="ttdeci">bool current_block_is_accum()</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00250">reader.cpp:250</a></div></div>
<div class="ttc" id="classreader_html_a2110381d3a8b2a4bb475a36b0a9fc259"><div class="ttname"><a href="classreader.html#a2110381d3a8b2a4bb475a36b0a9fc259">reader::read_dims</a></div><div class="ttdeci">bool read_dims(size_t &amp;n_dims, std::vector&lt; size_t &gt; &amp;dims)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00404">reader.cpp:404</a></div></div>
<div class="ttc" id="classreader_html_a41dd448b225a620bba7677d4e625b1ff"><div class="ttname"><a href="classreader.html#a41dd448b225a620bba7677d4e625b1ff">reader::check_file_num</a></div><div class="ttdeci">int check_file_num(int file_num)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00068">reader.cpp:68</a></div></div>
<div class="ttc" id="classreader_html_a74a42ddc95d153296836e4266894a4b8"><div class="ttname"><a href="classreader.html#a74a42ddc95d153296836e4266894a4b8">reader::read_data</a></div><div class="ttdeci">int read_data(data_array &amp;my_data_in, size_t time_range[3], size_t space_range[2], int flatten_on=-1)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00465">reader.cpp:465</a></div></div>
<div class="ttc" id="classreader_html_a0a4c4be70e266763e4f63f63f7f209a7"><div class="ttname"><a href="classreader.html#a0a4c4be70e266763e4f63f63f7f209a7">reader::change_block_id</a></div><div class="ttdeci">bool change_block_id(std::string new_id)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00175">reader.cpp:175</a></div></div>
<div class="ttc" id="classmy__array_html_ae527e9d9d3dfabcf78ec2c29229b2687"><div class="ttname"><a href="classmy__array.html#ae527e9d9d3dfabcf78ec2c29229b2687">my_array::populate_slice</a></div><div class="ttdeci">bool populate_slice(my_type *dat_in, size_t n_dims, size_t *offsets)</div><div class="ttdef"><b>Definition:</b> <a href="my__array_8cpp_source.html#l00574">my_array.cpp:574</a></div></div>
<div class="ttc" id="classreader_html_a06e742ffce5de2afebc0d7b300b6759b"><div class="ttname"><a href="classreader.html#a06e742ffce5de2afebc0d7b300b6759b">reader::space_range</a></div><div class="ttdeci">size_t space_range[2]</div><div class="ttdef"><b>Definition:</b> <a href="reader_8h_source.html#l00046">reader.h:46</a></div></div>
<div class="ttc" id="classreader_html_ad3d17b364b46f49e64f3fe093377e853"><div class="ttname"><a href="classreader.html#ad3d17b364b46f49e64f3fe093377e853">reader::get_full_name</a></div><div class="ttdeci">std::string get_full_name(int file_num)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00120">reader.cpp:120</a></div></div>
<div class="ttc" id="group__help_html_ga4400449ae193f353b2d9012e9b8c50f4"><div class="ttname"><a href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a></div><div class="ttdeci">void my_error_print(std::string text, int rank, int rank_to_write, bool noreturn)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00724">support.cpp:724</a></div></div>
<div class="ttc" id="group__help_html_ga98982a0c59613e879fb7b780eee46bba"><div class="ttname"><a href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a></div><div class="ttdeci">std::string mk_str(int i)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00762">support.cpp:762</a></div></div>
<div class="ttc" id="classdata__array_html_a3d0ef71b166616bb19a7084cab1f0945"><div class="ttname"><a href="classdata__array.html#a3d0ef71b166616bb19a7084cab1f0945">data_array::block_id</a></div><div class="ttdeci">char block_id[ID_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="data__array_8h_source.html#l00041">data_array.h:41</a></div></div>
<div class="ttc" id="classmy__array_html_abc6666203ecd7e742e2e9902d42ee10a"><div class="ttname"><a href="classmy__array.html#abc6666203ecd7e742e2e9902d42ee10a">my_array::populate_data</a></div><div class="ttdeci">bool populate_data(T dat_in, size_t n_tot)</div><div class="ttdef"><b>Definition:</b> <a href="my__array_8cpp_source.html#l00549">my_array.cpp:549</a></div></div>
<div class="ttc" id="classdata__array_html_addf2c1b94dff445a2e7ca4a3cc258ea0"><div class="ttname"><a href="classdata__array.html#addf2c1b94dff445a2e7ca4a3cc258ea0">data_array::is_good</a></div><div class="ttdeci">virtual bool is_good() const </div><div class="ttdef"><b>Definition:</b> <a href="data__array_8h_source.html#l00052">data_array.h:52</a></div></div>
<div class="ttc" id="classmy__array_html_a399815441ab623aa0b98aa390be56f4f"><div class="ttname"><a href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">my_array::get_dims</a></div><div class="ttdeci">size_t get_dims() const </div><div class="ttdef"><b>Definition:</b> <a href="my__array_8cpp_source.html#l00265">my_array.cpp:265</a></div></div>
<div class="ttc" id="classreader_html_af17226df8747ac3acb7ca1ee20349372"><div class="ttname"><a href="classreader.html#af17226df8747ac3acb7ca1ee20349372">reader::is_accum</a></div><div class="ttdeci">bool is_accum(std::string block_id)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00272">reader.cpp:272</a></div></div>
<div class="ttc" id="group__help_html_gab561211b55f0a58d07961cf05e256e06"><div class="ttname"><a href="group__help.html#gab561211b55f0a58d07961cf05e256e06">my_print</a></div><div class="ttdeci">void my_print(std::string text, int rank, int rank_to_write, bool noreturn)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00686">support.cpp:686</a></div></div>
<div class="ttc" id="group__const_html_gaa1a92c9b4b7de8220956b80d25b31723"><div class="ttname"><a href="group__const.html#gaa1a92c9b4b7de8220956b80d25b31723">ID_SIZE</a></div><div class="ttdeci">const int ID_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00082">support.h:82</a></div></div>
<div class="ttc" id="classreader_html_a7e05e99d5fb4db845f75ee7a75481363"><div class="ttname"><a href="classreader.html#a7e05e99d5fb4db845f75ee7a75481363">reader::update_ref_filenum</a></div><div class="ttdeci">void update_ref_filenum(int num)</div><div class="ttdef"><b>Definition:</b> <a href="reader_8cpp_source.html#l00140">reader.cpp:140</a></div></div>
<div class="ttc" id="classdata__array_html"><div class="ttname"><a href="classdata__array.html">data_array</a></div><div class="ttdoc">Extended my_array class including axes. </div><div class="ttdef"><b>Definition:</b> <a href="data__array_8h_source.html#l00025">data_array.h:25</a></div></div>
<div class="ttc" id="classdata__array_html_a33b8978a530070319dd4d06de62ca64d"><div class="ttname"><a href="classdata__array.html#a33b8978a530070319dd4d06de62ca64d">data_array::time</a></div><div class="ttdeci">my_type time[2]</div><div class="ttdef"><b>Definition:</b> <a href="data__array_8h_source.html#l00042">data_array.h:42</a></div></div>
<div class="ttc" id="group__str_html_gae617c689379826c6aa48a91868bf97c5"><div class="ttname"><a href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a></div><div class="ttdeci">mpi_info_struc mpi_info</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00021">support.cpp:21</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 6 2017 10:31:50 for WIPPS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
