<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>WIPPS: src/tests_data_and_calc.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="Doxy.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">WIPPS
   </div>
   <div id="projectbrief">Whistler-mode Interaction Post-Processing Suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">tests_data_and_calc.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//  tests_data_and_calc.cpp</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//  </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//  Breakout by Heather Ratcliffe on 27/02/2017.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#ifdef RUN_TESTS_AND_EXIT</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;tests_data_and_calc.h&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;reader.h&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;plasma.h&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;controller.h&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;data_array.h&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;spectrum.h&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;d_coeff.h&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;non_thermal.h&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;boost/math/special_functions.hpp&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;valgrind.h&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;test_entity_plasma::test_entity_plasma(){</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  name = <span class="stringliteral">&quot;plasma&quot;</span>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="comment">//Have to set-up deck constants before creating plasma</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="group__main.html#ga6c1eed606f17752cde3184c9137764f0">get_deck_constants</a>(tests_src_dir + <span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <a class="code" href="group__main.html#ga6a7867e1229358461bbc8d3b6e7f10ef">share_consts</a>();</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  plas = <span class="keyword">new</span> <a class="code" href="classplasma.html">plasma</a>(tests_src_dir + <span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;test_entity_plasma::~test_entity_plasma(){</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keyword">delete</span> plas;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;}</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keywordtype">int</span> test_entity_plasma::run(){</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="group__main.html#ga6c1eed606f17752cde3184c9137764f0">get_deck_constants</a>(tests_src_dir + <span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="group__main.html#ga6a7867e1229358461bbc8d3b6e7f10ef">share_consts</a>();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span>(!plas-&gt;is_good()){</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  err |= analytic_dispersion();</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  err |= high_density();</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  err |= resonant_freq();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  err |= resonant_freq_poly();</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  err |= other_modes();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  err |= phi_dom();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keywordtype">int</span> test_entity_plasma::analytic_dispersion(){</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> k, om, om_new, d_om, d_k;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> om_ce = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;ce&quot;</span>), om_pe = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;pe&quot;</span>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordtype">size_t</span> n_tests = 5;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">//First whistlers</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">//At very large k we should get om_ce and at 0, we get 0</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  k = 100;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">if</span>(std::abs(om /om_ce -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  k = 0;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">if</span>(std::abs(om) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">//Symmetry</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> om_2;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  k = 0.0001;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  k = -k;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  om_2 = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">if</span>(std::abs(om - om_2) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">//If we pick a few e.g.s and do them both ways we should get same result back. Start with omega for simplicity</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt;= n_tests; i++){</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    om = (float)i * om_ce/(<span class="keywordtype">float</span>) (n_tests +1);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    k = plas-&gt;get_dispersion(om, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    om_new = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span>(std::abs(om /om_new -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">//Derivs should be 0 at 0 for all cases and all modes</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  k=0;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">//Cheat and loop through the wave indices</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> wave_id = <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>; wave_id &lt;= <a class="code" href="group__const.html#ga088f6f069df3ceb21e1ca47e227ebd66">WAVE_O</a>; wave_id++){</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    d_om = plas-&gt;get_dispersion(k, wave_id, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span>(std::abs(d_om) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">//For whistler at large omega deriv is 0</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  k = 100;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  d_om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">if</span>(std::abs(d_om) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">//Finally derivs at our samples should be inverses</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt;= n_tests; i++){</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    om = (float)i * om_ce/(<span class="keywordtype">float</span>) (n_tests +1);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    k = plas-&gt;get_dispersion(om, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    d_om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    d_k = plas-&gt;get_dispersion(om, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span>(std::abs(d_om*d_k - 1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">//Quick check that omega is propto cos theta for fixed k, as is the derivative</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> theta, ref_om, ref_d_om;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i&lt; n_tests; i++){</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">//Some rough range of k&#39;s</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    k = 0.001;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    theta = (float) i / (<span class="keywordtype">float</span>) n_tests * <a class="code" href="group__const.html#gaad263464e010fff1b9b275a68e8cc34a">ANG_MAX</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>, <span class="keyword">false</span>, <span class="keyword">false</span>, theta);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    d_om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>, <span class="keyword">false</span>, <span class="keyword">true</span>, theta);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span>(i == 0){</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      ref_om = om;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      ref_d_om = d_om;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span>(std::abs(om -ref_om * cos(theta))/om &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a> || std::abs(d_om - ref_d_om * cos(theta))/d_om &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>){</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      test_bed -&gt; report_info(<span class="stringliteral">&quot;Wrong angle behaviour of Whistler dispersion&quot;</span>, 2);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">//Finally we check how it handles out of range</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    k = plas-&gt;get_dispersion(om_ce*1.5, <a class="code" href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }<span class="keywordflow">catch</span>(<span class="keyword">const</span> std::exception&amp; e){</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    std::string message = e.what();</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Exception in analytic dispersion, message &quot;</span> +message, 1);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">//Now EM and plasma</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">//At 0, we get om_pe for P and O, and X-mode cuts for X</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  k = 0;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#ga088f6f069df3ceb21e1ca47e227ebd66">WAVE_O</a>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">if</span>(std::abs(om - om_pe) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaf2ce0763f93e62b78eacb59c4c36f792">WAVE_PLASMA</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">if</span>(std::abs(om - om_pe) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#ga0cd3734ef3169bd6835352228d01150a">WAVE_X_LOW</a>);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> X_cut = 0.5 * (- om_ce +  std::sqrt(om_ce*om_ce + 4.0*om_pe*om_pe));</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">if</span>(std::abs(om - X_cut) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#ga2969bfa057f2ab3bc51e24503a978e6d">WAVE_X_UP</a>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  X_cut = 0.5 * (om_ce +  std::sqrt(om_ce*om_ce + 4.0*om_pe*om_pe));</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">if</span>(std::abs(om - X_cut) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">//And back again</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  X_cut = 0.5 * (- om_ce +  std::sqrt(om_ce*om_ce + 4.0*om_pe*om_pe))*(1.0 + <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>/5.0);<span class="comment">//Tiny bump to ensure we&#39;re in solvable range</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  k = plas-&gt;get_dispersion(X_cut, <a class="code" href="group__const.html#ga0cd3734ef3169bd6835352228d01150a">WAVE_X_LOW</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">if</span>(std::abs(k - 0.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  X_cut = 0.5 * ( om_ce +  std::sqrt(om_ce*om_ce + 4.0*om_pe*om_pe))*(1.0 + <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>/5.0);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  k = plas-&gt;get_dispersion(X_cut, <a class="code" href="group__const.html#ga2969bfa057f2ab3bc51e24503a978e6d">WAVE_X_UP</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">if</span>(std::abs(k - 0.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">//If we pick a few e.g.s and do them both ways we should get same result back. Go from say om_pe to 3om_pe</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt;= n_tests; i++){</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    om = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;pe&quot;</span>)*(1.0+ 2.0*(float)i/(<span class="keywordtype">float</span>) (n_tests +1));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    k = plas-&gt;get_dispersion(om, <a class="code" href="group__const.html#ga088f6f069df3ceb21e1ca47e227ebd66">WAVE_O</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    om_new = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#ga088f6f069df3ceb21e1ca47e227ebd66">WAVE_O</a>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span>(std::abs(om /om_new -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    k = plas-&gt;get_dispersion(om, <a class="code" href="group__const.html#gaf2ce0763f93e62b78eacb59c4c36f792">WAVE_PLASMA</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    om_new = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaf2ce0763f93e62b78eacb59c4c36f792">WAVE_PLASMA</a>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span>(std::abs(om /om_new -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">/*    k = plas-&gt;get_dispersion(om, WAVE_X_LOW, true);</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">    om_new = plas-&gt;get_dispersion(k, WAVE_X_LOW);</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">    if(std::abs(om /om_new -1.0) &gt; GEN_PRECISION) err |=TEST_WRONG_RESULT;*/</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    k = plas-&gt;get_dispersion(om, <a class="code" href="group__const.html#ga2969bfa057f2ab3bc51e24503a978e6d">WAVE_X_UP</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    om_new = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#ga2969bfa057f2ab3bc51e24503a978e6d">WAVE_X_UP</a>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span>(om &gt; X_cut){</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">if</span>(std::abs(om /om_new -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="comment">//Plasma wave goes to sqrt(3) v_t and O, X to c</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  k = 100;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> wave_id = <a class="code" href="group__const.html#ga088f6f069df3ceb21e1ca47e227ebd66">WAVE_O</a>; wave_id &lt;= <a class="code" href="group__const.html#ga088f6f069df3ceb21e1ca47e227ebd66">WAVE_O</a>; wave_id++){</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    d_om = plas-&gt;get_dispersion(k, wave_id, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span>(std::abs(d_om - <a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>)/<a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a> &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  d_om = plas-&gt;get_dispersion(k, <a class="code" href="group__const.html#gaf2ce0763f93e62b78eacb59c4c36f792">WAVE_PLASMA</a>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">if</span>(std::abs(d_om - std::sqrt(3)*0.01*<a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>)/d_om &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="comment">//Finally derivs at our samples should be inverses</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=1; i&lt;= n_tests; i++){</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    om = om_pe + (float)i *om_pe/(<span class="keywordtype">float</span>) (n_tests +1);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = <a class="code" href="group__const.html#gaf2ce0763f93e62b78eacb59c4c36f792">WAVE_PLASMA</a>; j&lt;= <a class="code" href="group__const.html#ga088f6f069df3ceb21e1ca47e227ebd66">WAVE_O</a>; j++){</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      k = plas-&gt;get_dispersion(om, j, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      d_om = plas-&gt;get_dispersion(k, j, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      d_k = plas-&gt;get_dispersion(om, j, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">if</span>(std::abs(d_om*d_k - 1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">//Finally we check how it handles out of range</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = <a class="code" href="group__const.html#gaf2ce0763f93e62b78eacb59c4c36f792">WAVE_PLASMA</a>; j &lt; <a class="code" href="group__const.html#ga0cd3734ef3169bd6835352228d01150a">WAVE_X_LOW</a>; j++){</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      k = plas-&gt;get_dispersion(plas-&gt;get_omega_ref(<span class="stringliteral">&quot;pe&quot;</span>)*0.3, j, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }<span class="keywordflow">catch</span>(<span class="keyword">const</span> std::exception&amp; e){</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    std::string message = e.what();</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Exception in analytic dispersion, message &quot;</span> +message, 1);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">if</span>(err == TEST_PASSED) test_bed-&gt;report_info(<span class="stringliteral">&quot;Analytic dispersion OK&quot;</span>, 1);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">else</span>  test_bed-&gt;report_info(<span class="stringliteral">&quot;Error in analytic dispersion&quot;</span>, 1);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;}</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keywordtype">int</span> test_entity_plasma::resonant_freq(){</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordtype">int</span> err=TEST_PASSED;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordtype">int</span> n_tests = 10;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  std::vector&lt;calc_type&gt; results;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <a class="code" href="structmu__dmudom.html">mu_dmudom</a> my_mu;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordtype">int</span> err_count = 0;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> x, v_par, n, om_ce_local, om_pe_local, om_ce_signed;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  om_ce_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;ce&quot;</span>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  om_pe_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;pe&quot;</span>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  om_ce_signed = - std::abs(om_ce_local);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> cos_theta, mu_tmp1, mu_tmp2;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> gamma;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing resonant frequency solver&quot;</span>, 1);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">//Check the n=0 and v=0 degenerate cases</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">//Zero angle, zero velocity, any n, expect empty result</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  results = plas-&gt;get_resonant_omega(0.0, 0.0, 1.0, -1);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">if</span>(results.size() != 1 &amp;&amp; (results[0]/om_ce_local - 1.0 &gt; PRECISION)){</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Erroneous solution when v=0 in resonant frequency solver&quot;</span>, 2);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> expected_result =  0.50, corresponding_v =  0.162251 * <a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>, omega_solution;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  gamma = <a class="code" href="group__main.html#ga689ada8162b91051964231de819f267b">gamma_rel</a>(corresponding_v);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  results = plas-&gt;get_resonant_omega(0.0, corresponding_v, gamma, -1);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">//Insert a known result here from the IDL code, with one root at 0 angle</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">//Since we&#39;re using a sample like this, only expect a few sf of equality as the IDL uses quite different process</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">if</span>(results.size() != 1 || std::abs(std::abs(results[0]/om_ce_local)-expected_result) &gt; LOW_PRECISION){</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Erroneous solution for example case in resonant frequency solver&quot;</span>, 2);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="comment">//Check over the range of other cases</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">//Loop over particle velocity, assuming propagation at alpha = pi/8 say</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> theta, test_angle = <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/8.0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii=0; ii&lt;n_tests; ii++){</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    v_par = (0.01 + 0.5*(float)ii/ (<span class="keywordtype">float</span>)(n_tests+1))* <a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">//Loop over angles</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt; n_tests; j++){</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      x = 4.0 * (float) j / (<span class="keywordtype">float</span>)(n_tests+1);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      theta = std::atan(x);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      cos_theta = std::cos(theta);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="comment">//Loop over n</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt; n_tests; k++){</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        n = -n_tests/2 + k*n_tests/2;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        gamma = <a class="code" href="group__main.html#ga689ada8162b91051964231de819f267b">gamma_rel</a>(v_par/cos(test_angle));</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        results = plas-&gt;get_resonant_omega(theta, v_par, gamma, n);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;results.size(); ++i){</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          omega_solution = results[i];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;          <span class="comment">//Solve Res condition for mu^2 = (kc/om)^2</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          mu_tmp1 = std::pow(<a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a> * (gamma * omega_solution - n*om_ce_signed)/(gamma * omega_solution * v_par *cos_theta), 2);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          mu_tmp2 = (1.0 - (std::pow(om_pe_local,2)/(omega_solution *(omega_solution + om_ce_signed*cos_theta))));</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          <span class="comment">//Since we&#39;re solving a cubic, expect roundoff error to be exacerbated, so we bump the threshold to roughly (5e-16)^(1/3) (cube root epsilon) and I&#39;ve tightened by a factor 10 also since I&#39;m doing fractional</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="keywordflow">if</span>(std::abs((mu_tmp1 - mu_tmp2)/mu_tmp1) &gt; 2.5*NUM_PRECISION){</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            err|=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            test_bed-&gt;report_info(<span class="stringliteral">&quot;Refractive index mismatch of &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((std::abs((mu_tmp1-mu_tmp2))/mu_tmp1)*100) +<span class="charliteral">&#39;%&#39;</span>, 2);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;          <span class="comment">//Also check against the full-mu solution</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          my_mu = plas-&gt;get_high_dens_mu(omega_solution, theta);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          <span class="keywordflow">if</span>(my_mu.<a class="code" href="structmu__dmudom.html#adb05c28e460513549326313a87675bae">err</a>){</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            err|=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            test_bed-&gt;report_info(<span class="stringliteral">&quot;No full mu solution for resonant frequency&quot;</span>, 2);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            err_count++;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="comment">//This should match the high-density mu solution almost exactly, once we remove the leading 1.0</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="keywordflow">if</span>(std::abs(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> - std::sqrt(mu_tmp2 - 1.0))/std::sqrt(mu_tmp2 - 1.0) &gt; NUM_PRECISION){</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;              err|=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;              test_bed-&gt;report_info(<span class="stringliteral">&quot;Mismatched full mu solution in resonant solver, error &quot;</span> + <a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(std::abs(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-std::sqrt(mu_tmp2-1.0))/std::sqrt(mu_tmp2-1.0)*100.0, <span class="keyword">true</span>)+<span class="charliteral">&#39;%&#39;</span>, 2);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;          }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Mu error count: &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(err_count), 2);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="keywordtype">int</span> test_entity_plasma::resonant_freq_poly(){</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordtype">int</span> err=TEST_PASSED;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordtype">int</span> n_tests = 30;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  std::vector&lt;calc_type&gt; results, HD_results;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <a class="code" href="structmu__dmudom.html">mu_dmudom</a> my_mu;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">int</span> err_count = 0;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> x, v_par, mod_v, n, om_ce_local, om_pe_local, om_ce_signed;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  om_ce_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;ce&quot;</span>);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  om_pe_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;pe&quot;</span>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  om_ce_signed = - std::abs(om_ce_local);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> cos_theta, mu_tmp1, mu_tmp2;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> gamma, tmp_result;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing resonant frequency polynomial solver&quot;</span>, 1);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">//Check the n=0 and v=0 degenerate cases</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">//Zero angle, zero velocity, any n, expect empty result</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  results = plas-&gt;get_resonant_omega_full(0.0, 0.0, 1.0, -1);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span>(results.size() != 1 &amp;&amp; (results[0]/om_ce_local - 1.0 &gt; PRECISION)){</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Erroneous solution when v=0 in resonant frequency solver&quot;</span>, 2);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">//Check over the range of cases</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">//Loop over particle velocity, assuming propagation at alpha = pi/8 say</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> theta, test_angle = <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/8.0;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii = 0; ii &lt; n_tests; ii++){</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    mod_v = (0.01 + (float)ii/ (<span class="keywordtype">float</span>)(n_tests+1))* <a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    v_par = mod_v * cos(test_angle);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    gamma = <a class="code" href="group__main.html#ga689ada8162b91051964231de819f267b">gamma_rel</a>(mod_v);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">//Loop over angles</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; n_tests; j++){</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      x = 4.0 * (float) j / (<span class="keywordtype">float</span>)(n_tests+1);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      theta = std::atan(x);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      cos_theta = std::cos(theta);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="comment">//Loop over n</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k = 0; k &lt; n_tests; k++){</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        n = -5 + k*10/n_tests;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        results = plas-&gt;get_resonant_omega_full(theta, v_par, gamma, n);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        HD_results = plas-&gt;get_resonant_omega(theta, v_par, gamma, n);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="comment">//Remove any HD results outside the NR bounds</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> nn = 0; nn &lt; HD_results.size(); nn++){</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          <span class="keywordflow">if</span>(HD_results[nn] &gt; om_ce_local*NR_max_om || HD_results[nn] &lt; om_ce_local*NR_min_om){</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            HD_results.erase(HD_results.begin() + nn);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            nn--;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="comment">//This check just makes sure the solver is not mis-reporting solutions, by checking they are actually solutions to the resonant poly.</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; results.size(); ++i){</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;          <span class="keywordflow">if</span>(!plas-&gt;check_resonant_omega_full(theta, v_par, gamma, n, results[i]/om_ce_local, tmp_result)){</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            test_bed-&gt;report_info(<span class="stringliteral">&quot;Non-root solution, value &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(results[i]));</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;          }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">if</span>(results.size() != HD_results.size()){</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;          <span class="keywordtype">bool</span> is_error = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          <span class="comment">//If mistmatch is due to solutions &quot;near&quot; min_om we can ignore</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          <span class="keywordtype">size_t</span> cnt1, cnt2;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          cnt1 = results.size();</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;          cnt2 = HD_results.size();</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; results.size(); i++){</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keywordflow">if</span>(results[i] &lt; 1.5*NR_min_om*om_ce_local) cnt1 --;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;          }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; HD_results.size(); i++){</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="keywordflow">if</span>(HD_results[i] &lt; 1.5*NR_min_om*om_ce_local) cnt2 --;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          <span class="keywordflow">if</span>(cnt1 != cnt2){</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            test_bed-&gt;report_info(<span class="stringliteral">&quot;Mismatched solution numbers &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(results.size()) +<span class="stringliteral">&quot; vs &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(HD_results.size()));</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">//          if (HD_results[0] != HD_results[0])std::cout&lt;&lt;theta&lt;&lt;&#39; &#39;&lt;&lt;v_par&lt;&lt;&#39; &#39;&lt;&lt;n&lt;&lt;&#39;\n&#39;;*/</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">/*          for(size_t i = 0; i &lt; HD_results.size(); ++i){</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">            std::cout&lt;&lt;&quot;HD &quot;&lt;&lt;HD_results[i]&lt;&lt;&#39;\n&#39;;</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">          for(size_t i = 0; i &lt; results.size(); ++i){</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">            std::cout&lt;&lt;&quot;full &quot;&lt;&lt;results[i]&lt;&lt;&#39;\n&#39;;</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;          </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          <span class="keywordflow">if</span>(HD_results.size() &gt; 1 &amp;&amp; HD_results[0] &gt; HD_results[1]){</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="comment">//Reverse cubic solutions to ensure smaller is first</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordtype">double</span> tmp = HD_results[0];</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            HD_results[0] = HD_results[1];</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            HD_results[1] = tmp;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          <span class="keywordflow">if</span>(results.size() &gt; 1 &amp;&amp; results[0] &gt; results[1]){</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="comment">//Reverse solutions to ensure smaller is first</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordtype">double</span> tmp = results[0];</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            results[0] = results[1];</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            results[1] = tmp;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;          }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i &lt; results.size(); ++i){</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keywordflow">if</span>(std::abs(results[i] - HD_results[i])/results[i] &gt; 0.15){</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;              err_count++;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;              err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;              test_bed-&gt;report_info(<span class="stringliteral">&quot;HD and full solution do not match, error &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((results[i] - HD_results[i])/results[i], <span class="keyword">true</span>) + <span class="stringliteral">&quot; at &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(i), 2);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;          }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Mu error count: &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(err_count), 2);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keywordtype">int</span> test_entity_plasma::high_density(){</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordtype">int</span> err=TEST_PASSED;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> om_ce_local, om_pe_local;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> mu_tmp2;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  om_ce_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;ce&quot;</span>);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  om_pe_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;pe&quot;</span>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordtype">size_t</span> n_tests = 10;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> tmp_omega = 0.0, tmp_theta = <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests+1), gamma_particle = 1.0;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <a class="code" href="structmu__dmudom.html">mu_dmudom</a> my_mu, my_mu_dens;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordtype">int</span> err_cnt = 0;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing whistler high density approx.&quot;</span>, 1);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i =0; i&lt;n_tests; i++){</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    tmp_omega += std::abs(om_ce_local)/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests + 1);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    my_mu = plas-&gt;get_phi_mu_om(tmp_omega, tmp_theta, 0.0, 0, gamma_particle);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    my_mu_dens = plas-&gt;get_high_dens_phi_mu_om(tmp_omega, tmp_theta, 0.0, 0, gamma_particle);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    mu_tmp2 = sqrt(1.0 - (std::pow(om_pe_local,2)/(tmp_omega*(tmp_omega + om_ce_local*std::cos(tmp_theta)))));</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span>(std::abs(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> &gt; LOW_PRECISION){</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      err_cnt++;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Mismatch in high density approx or dispersion solver at omega=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_omega/std::abs(om_ce_local), <span class="keyword">true</span>)+<span class="stringliteral">&quot; om_ce and theta= &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_theta/<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>)+<span class="stringliteral">&quot; pi&quot;</span>, 1);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Mu &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>)+<span class="stringliteral">&quot; difference &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> - mu_tmp2)+<span class="stringliteral">&quot; relative error &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>, <span class="keyword">true</span>), 2);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    mu_tmp2 = sqrt( - (std::pow(om_pe_local,2)/(tmp_omega*(tmp_omega + om_ce_local*std::cos(tmp_theta)))));</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span>(std::abs(my_mu_dens.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu_dens.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> &gt; NUM_PRECISION){</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      err_cnt++;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;  Mismatch in high density approx or dispersion solver at omega=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_omega/std::abs(om_ce_local), <span class="keyword">true</span>)+<span class="stringliteral">&quot; om_ce and theta= &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_theta/<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>)+<span class="stringliteral">&quot; pi&quot;</span>, 1);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;  Mu &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu_dens.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>)+<span class="stringliteral">&quot; difference &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu_dens.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> - mu_tmp2)+<span class="stringliteral">&quot; relative error &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((my_mu_dens.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu_dens.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>), 2);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  tmp_omega = 0.6*std::abs(om_ce_local);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i =0; i&lt;n_tests; i++){</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    tmp_theta += <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests+1);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    my_mu = plas-&gt;get_phi_mu_om(tmp_omega, tmp_theta, 0.0, 0, gamma_particle);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">/* my_mu.mu should roughly equal Stix 2.45*/</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    mu_tmp2 = sqrt(1.0 - (std::pow(om_pe_local,2)/(tmp_omega*(tmp_omega + om_ce_local*std::cos(tmp_theta)))));</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">if</span>(std::abs(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> &gt; LOW_PRECISION){</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      err_cnt++;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;    Mismatch in high density approx or dispersion solver at omega=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_omega/std::abs(om_ce_local), <span class="keyword">true</span>)+<span class="stringliteral">&quot; om_ce and theta= &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_theta/<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>)+<span class="stringliteral">&quot; pi&quot;</span>, 1);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;    Mu &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>)+<span class="stringliteral">&quot; difference &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> - mu_tmp2)+<span class="stringliteral">&quot; relative error &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>), 2);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">if</span>(err_cnt&gt; 0){</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Total &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(err_cnt)+<span class="stringliteral">&quot; out of &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(2*(<span class="keywordtype">int</span>)n_tests)+<span class="stringliteral">&quot; issues in high density approx or dispersion solver at precision: &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(LOW_PRECISION), 1);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">//err|=TEST_WRONG_RESULT;</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">//Make these a warning not an error because we expect them sometimes</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keywordtype">int</span> test_entity_plasma::other_modes(){</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> om_ce_local, om_pe_local;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> mu_tmp2, gamma_particle = 1.0;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  om_ce_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;ce&quot;</span>);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  om_pe_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;pe&quot;</span>);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing dispersion solver for plasma O mode&quot;</span>, 1);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordtype">size_t</span> n_tests = 10;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <a class="code" href="structmu__dmudom.html">mu_dmudom</a> my_mu;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">/*Try plasma wave modes in solvers, perpendicular propagation*/</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> tmp_omega = om_pe_local;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> tmp_theta = <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/2.0;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i =0; i&lt;n_tests; i++){</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    tmp_omega += std::abs(om_pe_local)/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests + 1);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    my_mu = plas-&gt;get_phi_mu_om(tmp_omega, tmp_theta, 0.0, 0, gamma_particle);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    mu_tmp2 = std::sqrt(std::pow(tmp_omega, 2) - std::pow(om_pe_local, 2))/tmp_omega;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">if</span>(std::abs(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> &gt; LOW_PRECISION){</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Error in approx or dispersion solver for plasma wave at &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_omega/std::abs(om_pe_local))+<span class="stringliteral">&quot; &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_theta), 1);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Mu &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>)+<span class="stringliteral">&quot; difference &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> - mu_tmp2)+<span class="stringliteral">&quot; relative error &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>), 2);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">/*Try left hand X mode too*/</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing dispersion solver for plasma X mode&quot;</span>, 1);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> omega_UH = std::sqrt(om_pe_local*om_pe_local + om_ce_local*om_ce_local);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; n_tests; i++){</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    tmp_omega += std::abs(om_pe_local)/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests + 1);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    my_mu = plas-&gt;get_phi_mu_om(tmp_omega, tmp_theta, 0.0, 0, gamma_particle, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    mu_tmp2 = std::sqrt(1.0 - std::pow(om_pe_local/tmp_omega, 2)*(std::pow(tmp_omega, 2) - std::pow(om_pe_local, 2))/(std::pow(tmp_omega, 2) - std::pow(omega_UH, 2)));</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span>(std::abs(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> &gt; LOW_PRECISION){</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Error in approx or dispersion solver for plasma wave at &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_omega/std::abs(om_pe_local))+<span class="stringliteral">&quot; &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_theta), 1);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Mu &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>)+<span class="stringliteral">&quot; difference &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> - mu_tmp2)+<span class="stringliteral">&quot; relative error &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>-mu_tmp2)/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>), 2);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;}</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="keywordtype">int</span> test_entity_plasma::phi_dom(){</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordtype">size_t</span> n_tests = 10;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> mu_tmp1, om_ce_local, tmp_phi;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  om_ce_local = plas-&gt;get_omega_ref(<span class="stringliteral">&quot;ce&quot;</span>);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> d_omega = std::abs(om_ce_local)/1e8;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> d_theta = <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests)/1e7;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="comment">//Derivative step size.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <a class="code" href="structmu__dmudom.html">mu_dmudom</a> my_mu, my_mu_p;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> tmp_omega = 0.0, tmp_theta = <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests), gamma_particle = 1.0;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing phi&quot;</span>, 1);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">//For phi all we can really do is check that it&#39;s positive (as it&#39;s a square) and check it&#39;s not NaN, especially for n=0, and also of &quot;order 1&quot;</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">for</span>( <span class="keywordtype">int</span> n = -4; n &lt; 4 ; n++){</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    my_mu = plas-&gt;get_high_dens_phi_mu_om(std::abs(om_ce_local)* 0.5, tmp_theta, <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/10.0, 0, gamma_particle);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">if</span>(my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a> != my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a> || my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a> &lt; 0){</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Phi is invalid in get_high_dens_phi_mu_om for n=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(n), 2);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    tmp_phi = my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    my_mu = plas-&gt;get_phi_mu_om(std::abs(om_ce_local)* 0.5, tmp_theta, <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/10.0, 0, gamma_particle);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">if</span>(my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a> != my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a> || my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a> &lt; 0){</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Phi is invalid in get_phi_mu_om for n=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(n), 2);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">//Allow 15%</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">if</span>((my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a>- tmp_phi)/my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a> &gt; 0.15){</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Inconsistent phi (&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(my_mu.<a class="code" href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">phi</a>)+ <span class="stringliteral">&quot;) with high dens phi (&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_phi)+<span class="stringliteral">&quot;) for n=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(n), 2);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span>(tmp_phi &lt; 0.1 || tmp_phi &gt; 10.0){</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Phi is not order 1 for n=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(n), 2);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing dmu/domega&quot;</span>, 1);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i =0; i&lt;n_tests; i++){</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    tmp_omega += std::abs(om_ce_local)/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests + 1);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    my_mu = plas-&gt;get_phi_mu_om(tmp_omega, tmp_theta, 0.0, 0, gamma_particle);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    my_mu_p = plas-&gt;get_phi_mu_om(tmp_omega+d_omega, tmp_theta, 0.0, 0, gamma_particle);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    mu_tmp1 = (my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> - my_mu_p.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>)/d_omega;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">if</span>(std::abs(std::abs(mu_tmp1/my_mu.<a class="code" href="structmu__dmudom.html#a2530bc728d44b3fb7f98857c2730835b">dmudom</a>) - 1.0) &gt; NUM_PRECISION){</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      err|=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Wrong derivative in get_phi_mu_om&quot;</span>, 2);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing dmu/dtheta&quot;</span>, 1);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  tmp_theta = 0.0;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  tmp_omega = 0.7*std::abs(om_ce_local);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i =0; i&lt;n_tests; i++){</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    tmp_theta += <a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/(<a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a>)(n_tests+1);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    my_mu = plas-&gt;get_phi_mu_om(tmp_omega, tmp_theta, 0.0, 0, gamma_particle);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    my_mu_p = plas-&gt;get_phi_mu_om(tmp_omega, tmp_theta+d_theta, 0.0, 0, gamma_particle);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    mu_tmp1 = -(my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a> - my_mu_p.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>)/d_theta;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span>(std::abs(std::abs(mu_tmp1 /my_mu.<a class="code" href="structmu__dmudom.html#aa305dea66f8fee9be94f45a5d626d2f4">dmudtheta</a>) - 1.0) &gt; NUM_PRECISION){</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      err|=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Wrong derivative in get_phi_mu_om at omega = &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_omega/std::abs(om_ce_local), <span class="keyword">true</span>) +<span class="stringliteral">&quot; and phi = &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_theta/<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>, <span class="keyword">true</span>)+<span class="stringliteral">&quot; pi&quot;</span>, 2);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;}</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">For getting the resonant frequency to consider errors will matter, but the noise in spectra can be expected to be a similar sort of error</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">*</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">The reason for using the better dispersion solver is a) to avoid any numerical derivatives in general and b) because some of the calculation depends on derivs of the refractive index</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">*So basically I am using the easy approx where a) it’s a genuine nightmare to do better (10-14th order polynomial) and b) I expect other errors to be similar or more important and c) I really hope it’s linear or polynomial in error*/</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">//----------------------------------------------------------------</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;test_entity_spectrum::test_entity_spectrum(){</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  name = <span class="stringliteral">&quot;spectrum checks&quot;</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  file_prefix = tests_src_dir;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;}</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;test_entity_spectrum::~test_entity_spectrum(){</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">if</span>(test_contr) <span class="keyword">delete</span> test_contr;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;}</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keywordtype">int</span> test_entity_spectrum::run(){</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <a class="code" href="group__main.html#ga6c1eed606f17752cde3184c9137764f0">get_deck_constants</a>(file_prefix);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <a class="code" href="group__main.html#ga6a7867e1229358461bbc8d3b6e7f10ef">share_consts</a>();</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  err|= setup();</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keywordflow">if</span>(!test_bed-&gt;check_for_abort(err)) err|= basic_tests1();</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">if</span>(!test_bed-&gt;check_for_abort(err)) err|= basic_tests2();</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordflow">if</span>(!test_bed-&gt;check_for_abort(err)) err|= technical_tests();</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordflow">if</span>(!test_bed-&gt;check_for_abort(err)) err|= albertGs_tests();</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;}</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="keywordtype">int</span> test_entity_spectrum::setup(){</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  test_dat_fft = <a class="code" href="classdata__array.html">data_array</a>(file_prefix + <span class="stringliteral">&quot;FFT_data.dat&quot;</span>);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordflow">if</span>(!test_dat_fft.is_good()){</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    err |= TEST_FATAL_ERR;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  test_contr = <span class="keyword">new</span> <a class="code" href="classcontroller.html">controller</a>(file_prefix);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;}</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="keywordtype">int</span> test_entity_spectrum::basic_tests1(){</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  std::fstream outfile;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordtype">size_t</span> len=0;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> total_error =0.0;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> * d_angle, * angle_data;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  test_contr-&gt;add_spectrum(test_dat_fft.get_dims(0), <a class="code" href="group__const.html#gaddeb0aec55e5cc252db1a24d8b33995d">DEFAULT_N_ANG</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="comment">//Delete and re-add to test that</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  test_contr-&gt;delete_current_spectrum();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  test_contr-&gt;add_spectrum(test_dat_fft.get_dims(0), <a class="code" href="group__const.html#gaddeb0aec55e5cc252db1a24d8b33995d">DEFAULT_N_ANG</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  test_contr-&gt;get_current_spectrum()-&gt;make_test_spectrum(<a class="code" href="group__const.html#ga518db694e7101247d80fee2079e31868">FUNCTION_DELTA</a>);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="comment">//Check angle distrib integrates to 1 for each case</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">//NOTE we can only do this if MIN_ANG is either 0 or is - MAX_ANG. otherwise we&#39;re into erf and bunk</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordtype">bool</span> is_symmetric=<span class="keyword">false</span>, is_zero = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">if</span>(std::abs(<a class="code" href="group__const.html#gaee346054cefa8833f52d7562cb54be70">ANG_MIN</a> + ANG_MAX) &lt; PRECISION) is_symmetric = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">if</span>(std::abs(<a class="code" href="group__const.html#gaee346054cefa8833f52d7562cb54be70">ANG_MIN</a>) &lt; PRECISION) is_zero = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordflow">if</span>(is_symmetric || is_zero){</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    len = test_contr-&gt;get_current_spectrum()-&gt;get_g_dims(1);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    d_angle = (<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> *) calloc(<a class="code" href="group__const.html#gaddeb0aec55e5cc252db1a24d8b33995d">DEFAULT_N_ANG</a>, <span class="keyword">sizeof</span>(<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a>));</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;<a class="code" href="group__const.html#gaddeb0aec55e5cc252db1a24d8b33995d">DEFAULT_N_ANG</a>-1; ++i){</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      d_angle[i] = std::abs(test_contr-&gt;get_current_spectrum()-&gt;get_ang_axis_element(i) - test_contr-&gt;get_current_spectrum()-&gt;get_ang_axis_element(i+1));</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    }</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    angle_data = (<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> *) malloc(len*<span class="keyword">sizeof</span>(<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a>));</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;len; i++){</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      *(angle_data + i) = test_contr-&gt;get_current_spectrum()-&gt;get_g_element(0, i);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    }</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    total_error = <a class="code" href="group__help.html#ga9c125e9455b3e1e14e28739de11287e5">integrator</a>(angle_data, len, d_angle);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    test_contr-&gt;get_current_spectrum()-&gt;make_test_spectrum(<a class="code" href="group__const.html#ga32f0cbb8e2b7d5a957a71446c467d6ab">FUNCTION_GAUSS</a>);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;len; i++) *(angle_data + i) = test_contr-&gt;get_current_spectrum()-&gt;get_g_element(0, i);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    total_error += <a class="code" href="group__help.html#ga9c125e9455b3e1e14e28739de11287e5">integrator</a>(angle_data, len, d_angle);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    test_contr-&gt;get_current_spectrum()-&gt;make_test_spectrum(<a class="code" href="group__const.html#ga35106e42f2f1e8a924add6e3e2d5511d">FUNCTION_ISO</a>);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;len; i++) *(angle_data + i) = test_contr-&gt;get_current_spectrum()-&gt;get_g_element(0, i);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    total_error += <a class="code" href="group__help.html#ga9c125e9455b3e1e14e28739de11287e5">integrator</a>(angle_data, len, d_angle);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> expected = is_zero ? 1.5 : 3.0;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">//Iso always integrates to 1. Gaussian and delta are always symmetric</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">if</span>(std::abs(total_error - expected)/3.0 &gt; NUM_PRECISION){</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Error in angular distribution integrals, value &quot;</span> + <a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(total_error, <span class="keyword">true</span>));</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span>(angle_data) free(angle_data);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">if</span>(d_angle) free(d_angle);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Cannot test assymmetric spectrum&quot;</span>);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  outfile.open(tests_tmp_dir+<span class="stringliteral">&quot;spect_testy.dat&quot;</span>, std::ios::binary|std::ios::out);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  test_contr-&gt;get_current_spectrum()-&gt;write_to_file(outfile);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  outfile.close();</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="keywordflow">if</span>(err == TEST_PASSED) test_bed-&gt;report_info(<span class="stringliteral">&quot;Test spectrum OK&quot;</span>);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;}</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="keywordtype">int</span> test_entity_spectrum::basic_tests2(){</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  std::fstream outfile, infile;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordtype">size_t</span> len = 0;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> total_error = 0.0;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  test_contr-&gt;get_current_spectrum()-&gt;generate_spectrum(test_dat_fft ,10, <a class="code" href="group__const.html#ga32f0cbb8e2b7d5a957a71446c467d6ab">FUNCTION_GAUSS</a>, <a class="code" href="group__const.html#gaa96713a7e2a9078df4dbdf2d604fe12b">DEFAULT_SPECTRUM_ANG_STDDEV</a>);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  test_spect = <a class="code" href="classdata__array.html">data_array</a>(file_prefix + <span class="stringliteral">&quot;spectrum.dat&quot;</span>);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordflow">if</span>(test_spect.is_good()){</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="comment">//We ignore frequencies below say 0.05 om_ce</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keyword">const</span> <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> * ax = test_spect.get_axis(0, len);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordtype">int</span> min_ind = 0;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span>(ax) min_ind = <a class="code" href="group__main.html#gac342126c26fa8d9b1f579f06ab064aa7">where</a>(ax+len/2, len/2, 17588.200*0.05);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    total_error = 0.0;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt; len/2 - min_ind; i++){</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      total_error += std::abs(test_contr-&gt;get_current_spectrum()-&gt;get_B_element(i)-test_spect.get_element(i));</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=len/2 + min_ind; i&lt; len; i++){</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      total_error += std::abs(test_contr-&gt;get_current_spectrum()-&gt;get_B_element(i)-test_spect.get_element(i));</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">if</span>(total_error &gt; LOW_PRECISION){</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Mismatch between generated spectrum and test spectrum of &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(total_error));</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="comment">/* Preserve the spectrum*/</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    outfile.open(tests_tmp_dir + <span class="stringliteral">&quot;spect_out.dat&quot;</span>, std::ios::binary|std::ios::out);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    test_contr-&gt;get_current_spectrum()-&gt;write_to_file(outfile);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    outfile.close();</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">if</span>(err == TEST_PASSED) test_bed-&gt;report_info(<span class="stringliteral">&quot;Generate spectrum OK&quot;</span>);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <a class="code" href="classdata__array.html">data_array</a> old_B = test_contr-&gt;get_current_spectrum()-&gt;copy_out_B();</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="comment">//Now dump to file and read back in and compare</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordtype">bool</span> err2 = test_contr-&gt;add_spectrum(tests_tmp_dir + <span class="stringliteral">&quot;spect_out.dat&quot;</span>);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keywordflow">if</span>(err2) err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <a class="code" href="classdata__array.html">data_array</a> new_B = test_contr-&gt;get_current_spectrum()-&gt;copy_out_B();</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">if</span>(!old_B.<a class="code" href="classdata__array.html#addf2c1b94dff445a2e7ca4a3cc258ea0">is_good</a>() || !new_B.<a class="code" href="classdata__array.html#addf2c1b94dff445a2e7ca4a3cc258ea0">is_good</a>() || (old_B != new_B)){</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Error or Mismatch in read&quot;</span>, 0);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      err|= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  }</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;}</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="keywordtype">void</span> test_entity_spectrum::set_vals(<a class="code" href="classspectrum.html">spectrum</a>&amp; spect){</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keywordflow">if</span>(!spect.<a class="code" href="classspectrum.html#a4e405518424b3e9f3e605903feea65e5">get_g_is_angle_only</a>()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keywordtype">size_t</span> om_sz = spect.<a class="code" href="group__spect_acc.html#ga495e5f5b91e2d5e35533ef53aa0be551">get_omega_length</a>();</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordtype">size_t</span> ang_sz = spect.<a class="code" href="group__spect_acc.html#gae358e8d750ff498b22023207cf9221fa">get_angle_length</a>();</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; om_sz; i++){</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    spect.<a class="code" href="group__spect_acc.html#ga9e736f31959430cbef0a6b2a01e36161">set_B_element</a>(i, i);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; ang_sz; i++){</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    spect.<a class="code" href="group__spect_acc.html#gaca5a1984d6f7b4ec3eb22f002d8ca9aa">set_g_element</a>(i, i*2);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;}</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keywordtype">int</span> test_entity_spectrum::technical_tests(){</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Checking technical aspects&quot;</span>, 2);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="comment">//Create empty spectrum</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <a class="code" href="classspectrum.html">spectrum</a> test_spect = <a class="code" href="classspectrum.html">spectrum</a>(10, 10, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  set_vals(test_spect);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <a class="code" href="classspectrum.html">spectrum</a> test_spect2 = test_spect;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">if</span>(test_spect2 != test_spect){</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Copy or equality problem&quot;</span>, 1);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    std::vector&lt;spectrum&gt; my_vec;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    my_vec.push_back(test_spect2);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    my_vec.push_back(test_spect2);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordflow">if</span>(my_vec[0] != test_spect2) err|= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  }<span class="keywordflow">catch</span>(<span class="keyword">const</span> std::exception&amp; e){</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="comment">//Swallow and continue if possible,</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    std::string message = e.what();</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Exception message &quot;</span> +message, 1);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">if</span>(err == TEST_PASSED) test_bed-&gt;report_info(<span class="stringliteral">&quot;Technical aspects OK&quot;</span>, 1);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;}</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="keywordtype">int</span> test_entity_spectrum::albertGs_tests(){</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> om_ce_local, om_pe_local, G1, G2, G1_analytic, G2_analytic, G1_tracker = 0.0;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  om_ce_local = test_contr-&gt;get_plasma().get_omega_ref(<span class="stringliteral">&quot;ce&quot;</span>);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  om_pe_local = test_contr-&gt;get_plasma().get_omega_ref(<span class="stringliteral">&quot;pe&quot;</span>);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> mass_ratio = 1.0/1836.2;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordtype">size_t</span> n_tests = 30;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> tmp_omega = 0.0, tmp_x;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  test_contr-&gt;add_spectrum(2048, DEFAULT_N_ANG, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keywordflow">if</span>(!test_contr-&gt;get_current_spectrum()-&gt;is_good()){</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Spectrum in invalid state. Aborting&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    err |=TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    err |=TEST_FATAL_ERR;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  test_contr-&gt;get_current_spectrum()-&gt;make_test_spectrum(<a class="code" href="group__const.html#ga32f0cbb8e2b7d5a957a71446c467d6ab">FUNCTION_GAUSS</a>);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> om_min, om_max, x_min, x_max, om_peak;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  om_min = 2000.0;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  om_max = 16500.0;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="comment">//make sure this is lower than the test spectrum axis range</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  x_min = 0.0;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  x_max = 0.4;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">//Because I(omega) uses COLD plasma dispersion it really doesn&#39;t work well at &quot;large&quot; angles, above say 30 deg. So we cut off really harshly here</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">//This might be a bit delicate with respect to the degree of mismatch, but I think the problem is just because of the cold vs warm approx and is enough for a sanity check</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  test_contr-&gt;get_current_spectrum()-&gt;truncate_om(om_min, om_max);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  test_contr-&gt;get_current_spectrum()-&gt;truncate_x(x_min, x_max);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  om_peak = test_contr-&gt;get_current_spectrum()-&gt;get_peak_omega();</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="comment">//Now we have a test spectrum. Need to know what its normalisations should be. And what the Albert functions should resolve to.</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> width = 0.1*om_peak;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  </div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; n_tests; i++){</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    tmp_omega = om_min + (float) i/(<span class="keywordtype">float</span>) n_tests * (om_max-om_min);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="comment">//Cover range from small to just below om_ce...</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    G1 = <a class="code" href="group__spect_gs.html#ga17ae0551b8817506f21e6e341cae0eba">get_G1</a>(test_contr-&gt;get_current_spectrum(), tmp_omega);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="comment">//Analytic calculations for truncated Gaussians, Albert</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    if(tmp_omega &gt; om_min &amp;&amp; tmp_omega &lt; om_max){</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      G1_analytic = 2.0 / std::sqrt(<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>) * std::exp( - std::pow((tmp_omega - om_peak)/width, 2));</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      G1_analytic /= (boost::math::erf((om_max - om_peak)/width) +boost::math::erf((om_peak - om_min)/width));</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      G1_analytic /=width;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      G1_analytic = 0.0;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    G1_tracker += G1_analytic;<span class="comment">//Keep sum to check we&#39;re not hitting zero everywhere</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="comment">//Arbitrary precision, slightly tuned to current parameters</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">if</span>( G1_analytic &gt; 0.0 &amp;&amp; ((G1 != 0.0 &amp;&amp; std::abs(G1-G1_analytic)/(G1) &gt; 0.02)|| (G1 == 0.0 &amp;&amp; G1_analytic != 0.0))){</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;G1 does not match analytic calc, relative error = &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((std::abs(G1/G1_analytic)-1.0)*100, <span class="keyword">true</span>)+<span class="stringliteral">&quot;% at &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_omega, <span class="keyword">true</span>), <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordflow">if</span>(G1_tracker &lt; <a class="code" href="group__type.html#gaa6d335620eb2886edaffd3aae2ce1b02">tiny_my_type</a>){</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;G1 is always zero&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordtype">size_t</span> ang_sz = test_contr-&gt;get_current_spectrum()-&gt;get_angle_length();</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> I_om = 0.0;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordtype">size_t</span> counter = 0, none_counter = 0;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 1; j &lt; n_tests; j++){</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    tmp_omega = (float) j/(<span class="keywordtype">float</span>) (n_tests) * std::abs(om_ce_local);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    I_om = calc_I_omega(tmp_omega, test_contr-&gt;get_current_spectrum(), test_contr);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; ang_sz;i++){</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      counter++;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      tmp_x = test_contr-&gt;get_current_spectrum()-&gt;get_ang_axis_element(i);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      G2 = <a class="code" href="group__spect_gs.html#gac4e945a80fc683805c6731103949f1fa">get_G2</a>(test_contr-&gt;get_current_spectrum(), tmp_omega, tmp_x);</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      G2_analytic = 0.0;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <span class="keywordflow">if</span>((tmp_omega &gt; om_min &amp;&amp; tmp_omega &lt; om_max &amp;&amp; tmp_x &gt; x_min &amp;&amp; tmp_x &lt; x_max)){</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        G2_analytic = std::pow((( mass_ratio / (1.0 + mass_ratio))*om_ce_local*om_ce_local/om_pe_local/om_pe_local), 1.5);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <span class="comment">//Same g in num and denom so don&#39;t need to normalise</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        G2_analytic *= test_contr-&gt;get_current_spectrum()-&gt;get_g_element(i);</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        G2_analytic /= I_om;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        G2_analytic *= 2.0;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        G2_analytic = 0.0;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="comment">//Both should be &quot;non-zero&quot; and we allow rather large mismatch. See caveat above.</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">if</span>(G2_analytic &gt; 1e-30 &amp;&amp; G2 &gt; 1e-30 &amp;&amp; std::abs(G2/G2_analytic - 1.0) &gt; 0.1){</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        none_counter++;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        test_bed-&gt;report_info(<span class="stringliteral">&quot;G2 does not match analytic calc, relative error = &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((std::abs(G2/G2_analytic)-1.0)*100, <span class="keyword">true</span>)+<span class="stringliteral">&quot;% at omega=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_omega/om_ce_local, <span class="keyword">true</span>)+<span class="stringliteral">&quot; and x=&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp_x, <span class="keyword">true</span>), <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    }</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keywordflow">if</span>(none_counter &gt; 0) <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Tested &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(counter)+<span class="stringliteral">&quot; and got &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(none_counter)+<span class="stringliteral">&quot; errors&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  std::fstream outfile;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  outfile.open(tests_tmp_dir + <span class="stringliteral">&quot;spect_truncated.dat&quot;</span>, std::ios::out|std::ios::binary);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  test_contr-&gt;get_current_spectrum()-&gt;write_to_file(outfile);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  outfile.close();</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;}</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> calc_I_omega(<a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> omega, <a class="code" href="classspectrum.html">spectrum</a> * my_spect, <a class="code" href="classcontroller.html">controller</a> * my_contr){</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> Psi, Psi2, theta, x, dx, g_x, I_contrib, I_contrib2, I_om = 0.0, om_sq_p_e;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordtype">size_t</span> x_sz = my_spect-&gt;<a class="code" href="group__spect_acc.html#gae358e8d750ff498b22023207cf9221fa">get_angle_length</a>();</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> om_ce_local = my_contr-&gt;<a class="code" href="classcontroller.html#ab41dac6ef7a39184b45b03287c15394e">get_plasma</a>().<a class="code" href="classplasma.html#aeb9d7e766639b4d61ce856e352386bc4">get_omega_ref</a>(<span class="stringliteral">&quot;ce&quot;</span>);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> om_pe_local = my_contr-&gt;<a class="code" href="classcontroller.html#ab41dac6ef7a39184b45b03287c15394e">get_plasma</a>().<a class="code" href="classplasma.html#aeb9d7e766639b4d61ce856e352386bc4">get_omega_ref</a>(<span class="stringliteral">&quot;pe&quot;</span>);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> M = 1.0/1836.2;<span class="comment">//m_e/m_p</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> om_cp = om_ce_local*M;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  om_sq_p_e = omega*omega/om_ce_local/om_cp;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <a class="code" href="structmu__dmudom.html">mu_dmudom</a> my_mu;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <a class="code" href="classplasma.html">plasma</a> my_plas = my_contr-&gt;<a class="code" href="classcontroller.html#ab41dac6ef7a39184b45b03287c15394e">get_plasma</a>();</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  I_om = 0.0;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 1; i &lt; x_sz; i++){</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    x = <a class="code" href="group__const.html#ga3a65933f8b2c375c79e3025ddf0736fb">TAN_MAX</a> * (float)i/ (<span class="keywordtype">float</span>)x_sz;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    dx = <a class="code" href="group__const.html#ga3a65933f8b2c375c79e3025ddf0736fb">TAN_MAX</a>/(<span class="keywordtype">float</span>)x_sz;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    theta = std::atan(x);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    my_mu = my_plas.get_mu(omega, theta);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    if(!my_mu.err &amp;&amp; std::abs(omega) &lt; std::abs(om_ce_local*cos(theta))){</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="comment">//Mu has no solutions where omega exceeds Om_ce*cos(theta), or when there&#39;s an err</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">//NB sign selected for Whistler branch</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="comment">//Psi from cold plasma theory</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      Psi2 = 1.0 - om_sq_p_e - std::pow(std::sin(theta), 2)/2.0 + std::sqrt(std::pow(std::sin(theta), 4)/4.0 + std::pow(omega/om_cp*(1.0 - M)*cos(theta), 2));</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="comment">//Steal Psi value from mu using Lyons \cite Lyons1974B Eq 12</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="comment">//Psi from &quot;warm&quot; theory, high dens, see mu assignment</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      Psi = std::pow(om_pe_local/om_ce_local, 2) * (1.0+M)/M / my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>/my_mu.<a class="code" href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu</a>;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      g_x = my_spect-&gt;<a class="code" href="group__spect_acc.html#gacac016090ac42d512b198d4f3bcb7b9d">get_g_element</a>(i);</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      I_contrib = x * std::pow( (1.0 + x*x)*Psi, -1.5);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      I_contrib2 = 1.0 + 1.0/Psi * (om_sq_p_e - 0.5 * std::pow(omega/om_pe_local*(1.0-M), 2)/(( 1.0+ x*x)*(Psi - 1.0 + om_sq_p_e ) + 0.5*x*x ) );</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      I_om += g_x * I_contrib * I_contrib2 * dx;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    }</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  }</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keywordflow">return</span> I_om;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;}</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">//----------------------------------------------------------------</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;test_entity_levelone::test_entity_levelone(){</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  name = <span class="stringliteral">&quot;level-one derivation&quot;</span>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  test_contr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  my_reader = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;}</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;test_entity_levelone::~test_entity_levelone(){</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keyword">delete</span> test_contr;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keyword">delete</span> my_reader;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;}</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="keywordtype">int</span> test_entity_levelone::run(){</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="keywordflow">if</span>(test_bed-&gt;runtime_flags.count(<span class="stringliteral">&quot;level_one&quot;</span>) != 0){</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    block_id = <span class="stringliteral">&quot;ax&quot;</span>;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    file_prefix = tests_src_dir + <span class="stringliteral">&quot;l1/l1&quot;</span>;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    space_in[0] = 0;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    space_in[1] = 1024;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    time_in[0] = 0;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    time_in[1] = 4;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    time_in[2] = 100;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    err|= setup();</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span>(!test_bed-&gt;check_for_abort(err)) err|= basic_tests(1, -1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">if</span>(my_reader){</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="keyword">delete</span> my_reader;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      my_reader = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    }</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">if</span>(test_contr){</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keyword">delete</span> test_contr;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      test_contr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    }</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">if</span>(!test_bed-&gt;check_for_abort(err)){</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      file_prefix = tests_src_dir + <span class="stringliteral">&quot;2dtest/&quot;</span>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      block_id = <span class="stringliteral">&quot;ey&quot;</span>;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      space_in[0] = 0;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      space_in[1] = 1024;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      time_in[0] = 0;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      time_in[1] = 50;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      time_in[2] = 0;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      err|=setup();</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      <span class="keywordflow">if</span>(!test_bed-&gt;check_for_abort(err)) err |= basic_tests(2, 1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="keywordflow">if</span>(!test_bed-&gt;check_for_abort(err)) err |= basic_tests(2, -1, <span class="keyword">false</span>, <span class="stringliteral">&quot;_space&quot;</span>, 2, 0.01f*<a class="code" href="group__str.html#gac15fa2bad2324428e4f11544709ab4b3">my_const</a>.<a class="code" href="structdeck__constants.html#a68a93a10e418b02ef9713e2b4543f9f8">omega_ce</a>, 1.5f*<a class="code" href="group__str.html#gac15fa2bad2324428e4f11544709ab4b3">my_const</a>.<a class="code" href="structdeck__constants.html#a68a93a10e418b02ef9713e2b4543f9f8">omega_ce</a>);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Skipping level-one tests, flag -level_one not set&quot;</span>, 0);</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;}</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="keywordtype">int</span> test_entity_levelone::setup(){</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  my_reader = <span class="keyword">new</span> <a class="code" href="classreader.html">reader</a>(file_prefix, block_id);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="keywordflow">if</span>(my_reader-&gt;current_block_is_accum()){</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    n_tims = time_in[2];</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    n_tims = std::max((<span class="keywordtype">int</span>) (time_in[1]-time_in[0]), 1);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="keywordtype">size_t</span> n_dims;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  std::vector&lt;size_t&gt; dims;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keywordtype">int</span> err2 = my_reader-&gt;read_dims(n_dims, dims);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="keywordflow">if</span>(err2) err |= TEST_FATAL_ERR;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  test_contr = <span class="keyword">new</span> <a class="code" href="classcontroller.html">controller</a>(file_prefix);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;}</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="keywordtype">int</span> test_entity_levelone::basic_tests(<span class="keywordtype">size_t</span> n_dims_in, <span class="keywordtype">int</span> flatten_on, <span class="keywordtype">bool</span> has_freq, std::string outfile_tag, <span class="keywordtype">int</span> total_fft, <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> band_min, <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> band_max){</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordtype">size_t</span> n_dims;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  std::vector&lt;size_t&gt; dims;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordtype">int</span> err2 = my_reader-&gt;read_dims(n_dims, dims);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordflow">if</span>(err2){</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    err |= TEST_FATAL_ERR;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  }</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordflow">if</span>(n_dims != n_dims_in){</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Wrong file dimension&quot;</span>, 1);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">return</span> TEST_FATAL_ERR;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">//Cut out section here</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordtype">int</span> space_dim = space_in[1]-space_in[0];</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="comment">//Different size for space processing versus &quot;normal&quot;</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">if</span>(total_fft &gt;= 0){</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    dat = <a class="code" href="classdata__array.html">data_array</a>(space_dim, dims[1], n_tims);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    dat = <a class="code" href="classdata__array.html">data_array</a>(space_dim, n_tims);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  }</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordflow">if</span>(!dat.is_good()){</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Data array allocation failed.&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    err |= TEST_FATAL_ERR;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  }</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="keywordflow">if</span>(flatten_on &lt; 0){</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    err2 = my_reader-&gt;read_data(dat, time_in, space_in);</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    err2 = my_reader-&gt;read_data(dat, time_in, space_in, flatten_on);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  }</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordflow">if</span>(err2 == 1){</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">return</span> TEST_FATAL_ERR;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  }</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="keywordflow">if</span>(err2 == 2) n_tims = dat.get_dims(dat.get_dims() - 1);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="comment">//Check if we had to truncate data array...</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  dat_fft = <a class="code" href="classdata__array.html">data_array</a>();</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  dat_fft.clone_empty(dat);</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordflow">if</span>(!dat_fft.is_good()){</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">return</span> TEST_FATAL_ERR;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  dat.B_ref = <a class="code" href="group__main.html#gabbf945327481eed752399901fccfe617">get_ref_Bx</a>(file_prefix, space_in, 1);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="comment">//Use first file. 0th accumulator is perhaps broken</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  err2 = fft_array(dat,dat_fft);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="keywordflow">if</span>(total_fft &gt;= 0){</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    dat_fft = dat_fft.total(total_fft, band_min, band_max);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  }</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;FFT returned err_state &quot;</span> + <a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(err2));</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  test_contr-&gt;set_plasma_B0(dat.B_ref);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  test_contr-&gt;add_spectrum(space_dim, DEFAULT_N_ANG, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  test_contr-&gt;get_current_spectrum()-&gt;generate_spectrum(dat_fft, 10, <a class="code" href="group__const.html#ga32f0cbb8e2b7d5a957a71446c467d6ab">FUNCTION_GAUSS</a>, <a class="code" href="group__const.html#gaa96713a7e2a9078df4dbdf2d604fe12b">DEFAULT_SPECTRUM_ANG_STDDEV</a>);</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  </div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  n_dims = dat_fft.get_dims();</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="comment">//Set cutout limits on FFT</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  std::vector&lt;my_type&gt; lims;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <span class="keywordflow">if</span>(n_dims &gt;=3){</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    lims.push_back(-0.002);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    lims.push_back(0.002);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  }</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <span class="keywordflow">if</span>(n_dims &gt;=2){</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    lims.push_back(-0.002);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    lims.push_back(0.002);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordflow">if</span>(has_freq){</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      lims.push_back(-3.0*<a class="code" href="group__str.html#gac15fa2bad2324428e4f11544709ab4b3">my_const</a>.<a class="code" href="structdeck__constants.html#a68a93a10e418b02ef9713e2b4543f9f8">omega_ce</a>);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      lims.push_back(3.0*<a class="code" href="group__str.html#gac15fa2bad2324428e4f11544709ab4b3">my_const</a>.<a class="code" href="structdeck__constants.html#a68a93a10e418b02ef9713e2b4543f9f8">omega_ce</a>);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      lims.push_back(-0.002);</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      lims.push_back(0.002);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    }</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  <span class="comment">//Dump files and then compare to reference files</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  std::string filename, full_filename, time_str;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  time_str = <a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(dat_fft.time[0], <span class="keyword">true</span>)+<span class="stringliteral">&quot;_&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(this-&gt;n_tims);</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  std::string block = block_id;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  filename = <span class="stringliteral">&quot;FFT_&quot;</span>+block +<span class="stringliteral">&quot;_&quot;</span>+time_str+<span class="stringliteral">&quot;_&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(dat_fft.space[0])+<span class="stringliteral">&quot;_&quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(dat_fft.space[1]) + outfile_tag+<span class="stringliteral">&quot;.dat&quot;</span>;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  full_filename = tests_tmp_dir + filename;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  std::fstream file;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  file.open(full_filename.c_str(),std::ios::out|std::ios::binary);</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="keywordflow">if</span>(file.is_open()){</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    dat_fft.write_section_to_file(file, lims);</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="keywordflow">if</span>(err2){</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;File writing failed&quot;</span>);</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      err |=TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  </div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  }</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  file.close();</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;FFT section output in &quot;</span>+full_filename, 1);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <a class="code" href="classdata__array.html">data_array</a> previous_fft(file_prefix + <span class="stringliteral">&quot;tests/&quot;</span>+ filename+<span class="stringliteral">&quot;.ref&quot;</span>);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  dat_fft = <a class="code" href="classdata__array.html">data_array</a>(full_filename);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="keywordflow">if</span>(previous_fft != dat_fft){</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;New FFT does not match reference&quot;</span>);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  }</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  full_filename = <a class="code" href="group__help.html#gab9d50e3f67f2510d4560b31729ef7198">append_into_string</a>(full_filename, <span class="stringliteral">&quot;_spectrum&quot;</span>);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  filename = <a class="code" href="group__help.html#gab9d50e3f67f2510d4560b31729ef7198">append_into_string</a>(filename, <span class="stringliteral">&quot;_spectrum&quot;</span>);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  file.open(full_filename.c_str(),std::ios::out|std::ios::binary);</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordflow">if</span>(file.is_open()){</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    test_contr-&gt;get_current_spectrum()-&gt;write_to_file(file);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">if</span>(err2){</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;File writing failed&quot;</span>);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      err |=TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    }</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    </div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    err |=TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  </div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  }</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  file.close();</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Spectrum output in &quot;</span>+full_filename, 1);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  test_contr-&gt;add_spectrum(file_prefix + <span class="stringliteral">&quot;tests/&quot;</span> + filename + <span class="stringliteral">&quot;.ref&quot;</span>);</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordflow">if</span>(test_contr-&gt;get_current_spectrum() != <span class="keyword">nullptr</span> &amp;&amp; test_contr-&gt;get_spectrum_by_num(1) != <span class="keyword">nullptr</span> &amp;&amp; *(test_contr-&gt;get_current_spectrum()) != *(test_contr-&gt;get_spectrum_by_num(1))){</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;New spectrum does not match reference&quot;</span>);</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  }</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;}</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">//----------------------------------------------------------------</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;test_entity_d::test_entity_d(){</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  name = <span class="stringliteral">&quot;D checks&quot;</span>;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  file_prefix = tests_src_dir + <span class="stringliteral">&quot;d_test&quot;</span>;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  test_contr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  partial_disable_for_valgrind = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;}</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;test_entity_d::~test_entity_d(){</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="keywordflow">if</span>(test_contr) <span class="keyword">delete</span> test_contr;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;}</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="keywordtype">int</span> test_entity_d::run(){</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="preprocessor">#ifdef RUNNING_ON_VALGRIND</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="keywordflow">if</span>(RUNNING_ON_VALGRIND){</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <a class="code" href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a>(<span class="stringliteral">&quot;Detected valgrind.\n There is an extended precision bug so boost::math bessel functions don&#39;t work correctly.\n        Some D tests will not be performed&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    partial_disable_for_valgrind = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">//Valgrind doesn&#39;t support extended precision, so the boost::math definition of a &quot;tiny&quot; to protect against divide by zero is equal 0 resulting in NaN. This is a known &quot;bug&quot; so we just skip certain D tests if valgrind is in use, as they will fail</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <a class="code" href="structdeck__constants.html">deck_constants</a> const_tmp = <a class="code" href="group__str.html#gac15fa2bad2324428e4f11544709ab4b3">my_const</a>;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a> == 0) <a class="code" href="group__main.html#ga6c1eed606f17752cde3184c9137764f0">get_deck_constants</a>(file_prefix);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <a class="code" href="group__main.html#ga6a7867e1229358461bbc8d3b6e7f10ef">share_consts</a>();</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  test_contr = <span class="keyword">new</span> <a class="code" href="classcontroller.html">controller</a>(file_prefix);</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  err |= basic_tests();</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="keywordflow">if</span>(test_bed-&gt;runtime_flags.count(<span class="stringliteral">&quot;full_d&quot;</span>) &gt; 0){</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    err |= full_D_tests();</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Skipping full_D tests. Invoke with flag -full_d&quot;</span>, 0);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  }</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <a class="code" href="group__str.html#gac15fa2bad2324428e4f11544709ab4b3">my_const</a> = const_tmp;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <a class="code" href="group__main.html#ga6a7867e1229358461bbc8d3b6e7f10ef">share_consts</a>();</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;}</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="keywordtype">int</span> test_entity_d::basic_tests(){</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Reading spectrum&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <span class="comment">//Now dump to file and read back in and compare</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  <span class="keywordtype">bool</span> err2 = test_contr-&gt;add_spectrum(tests_tmp_dir + <span class="stringliteral">&quot;spect_out.dat&quot;</span>);</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  <span class="keywordflow">if</span>(!err2){</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Calculating test D&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    test_contr-&gt;add_d(5, 5);</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="keywordflow">if</span>(!test_contr-&gt;get_current_d()){</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      <span class="comment">//Can&#39;t go on, have no D!!!</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      err |= TEST_FATAL_ERR;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <a class="code" href="structd__report.html">d_report</a> report = test_contr-&gt;get_current_d()-&gt;calculate();</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="keywordflow">if</span>(report.<a class="code" href="structd__report.html#aabb53ca65e3c0c3ee800faf98905d6d0">error</a>){</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Error calculating D&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  }</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Testing D IO&quot;</span>);</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="comment">//Modify some fields to non-default</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  test_contr-&gt;get_current_d()-&gt;wave_id = 3;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  test_contr-&gt;get_current_d()-&gt;tag = <span class="stringliteral">&quot;IO test, long tag&quot;</span>;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="comment">//Write the current D to file</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  std::fstream outfile;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  std::string filename = tests_tmp_dir + <span class="stringliteral">&quot;d_dump.txt&quot;</span>;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  outfile.open(filename.c_str(), std::ios::binary|std::ios::out|std::ios::in|std::ios::trunc);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  test_contr-&gt;get_current_d()-&gt;write_to_file(outfile);</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  outfile.close();</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="comment">//Create new empty D</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  err2 = test_contr-&gt;add_spectrum(tests_tmp_dir + <span class="stringliteral">&quot;spect_out.dat&quot;</span>);</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  test_contr-&gt;add_d(5, 5);</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="comment">//Read from file</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  outfile.open(filename.c_str(), std::ios::binary|std::ios::in);</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  test_contr-&gt;get_current_d()-&gt;read_from_file(outfile);</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="comment">//Check equality</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordtype">bool</span> D_is_eq = <span class="keyword">true</span>;<span class="comment">//Flag for equality of written and read D</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <span class="keywordtype">bool</span> D_is_bad = <span class="keyword">false</span>;<span class="comment">//Flag for if written D contains NaN elements</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="keywordtype">bool</span> D_bad_element = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; 5; i++){</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt; 5; j++){</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="keywordflow">if</span>(test_contr-&gt;get_d_by_num(1)-&gt;get_element(i, j) != test_contr-&gt;get_d_by_num(1)-&gt;get_element(i, j)){</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;         D_bad_element = <span class="keyword">true</span>;<span class="comment">//Element is NaN in written array</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;         D_is_bad = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      }</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      <span class="keywordflow">if</span>(!D_bad_element &amp;&amp; test_contr-&gt;get_d_by_num(1)-&gt;get_element(i, j) != test_contr-&gt;get_current_d()-&gt;get_element(i, j)) D_is_eq = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        <span class="comment">//We wrote a NaN element so will never be equal</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      D_bad_element = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    }</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  }</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordflow">if</span>(test_contr-&gt;get_d_by_num(1)-&gt;wave_id != test_contr-&gt;get_current_d()-&gt;wave_id) D_is_eq = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="comment">//Note tag gets truncated to ten chars in writing</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="keywordflow">if</span>(test_contr-&gt;get_d_by_num(1)-&gt;tag.substr(0, 9) != test_contr-&gt;get_current_d()-&gt;tag.substr(0, 9)) D_is_eq = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="keywordflow">if</span>(D_is_bad &amp;&amp; !partial_disable_for_valgrind){</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="comment">//Due to valgrind issue described in ::run(), D might be NaN but this is not our fault...</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;D contains NaN!&quot;</span>);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  }</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  </div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="keywordflow">if</span>(!D_is_eq){</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Error reading D from file&quot;</span>);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    err |= TEST_USERDEF_ERR1;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;}</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="keywordtype">int</span> test_entity_d::full_D_tests(){</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordtype">bool</span> single_n = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <span class="keywordtype">int</span> n = 0;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <span class="keywordtype">bool</span> err2 = test_contr-&gt;add_spectrum(file_prefix + <span class="stringliteral">&quot;spectrum.dat&quot;</span>);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keywordflow">if</span>(!err2){</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Calculating full D... This may take a (very) long time!\nEnsure optimisation is on during compile!&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    test_contr-&gt;add_d(100, 100);</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    </div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">if</span>(test_bed-&gt;runtime_flags.count(<span class="stringliteral">&quot;n&quot;</span>) != 0){</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      single_n = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      n  = test_bed-&gt;runtime_flags[<span class="stringliteral">&quot;n&quot;</span>];</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      test_contr-&gt;get_current_d()-&gt;set_single_n(n);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      test_contr-&gt;get_current_d()-&gt;set_max_n(5);</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    D_type_spec D_type = D_type_spec::alpha_alpha;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordflow">if</span>(test_bed-&gt;runtime_flags.count(<span class="stringliteral">&quot;d_pp&quot;</span>) != 0){</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      D_type = D_type_spec::p_p;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    }</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <a class="code" href="structd__report.html">d_report</a> report = test_contr-&gt;get_current_d()-&gt;calculate(D_type);</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">if</span>(report.<a class="code" href="structd__report.html#aabb53ca65e3c0c3ee800faf98905d6d0">error</a>){</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Error calculating full D&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    }</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Average resonant number &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(report.<a class="code" href="structd__report.html#ac99c94c960788fe0b04bab8011ed38e4">n_av</a>), 2);<span class="comment">//Num resonances is 2* this +1 </span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordflow">if</span>(!report.<a class="code" href="structd__report.html#a0688c082333ab3edcfd3b22b09390430">single_n</a>) test_bed-&gt;report_info(<span class="stringliteral">&quot;Max resonant number &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(report.<a class="code" href="structd__report.html#ab689de1ad055c221d20cc4a2002139ee">n_max</a>), 2);</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    </div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Writing test file&quot;</span>, <a class="code" href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a>.<a class="code" href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">rank</a>);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    std::fstream file;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    file.open(<span class="stringliteral">&quot;test_d.dat&quot;</span>, std::ios::binary|std::ios::trunc|std::ios::out|std::ios::in);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">if</span>(file) test_contr-&gt;get_current_d()-&gt;write_to_file(file);</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    file.close();</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <a class="code" href="classdata__array.html">data_array</a> padie_data = read_padie_data(single_n, n, (D_type == D_type_spec::p_p));</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="comment">//Now we should read a file containing sample D info and compare some features. Perhaps the Landau peak?</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="comment">//Check axes match. Remember D has first velocity, padie is just 1-d of angle</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="keywordflow">if</span>(padie_data.<a class="code" href="classdata__array.html#addf2c1b94dff445a2e7ca4a3cc258ea0">is_good</a>()){</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      <span class="comment">//Find energy bin to use. Padie is at 1 MeV, so 0.941c</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      <span class="keywordtype">size_t</span> v_ind = test_contr-&gt;get_current_d()-&gt;get_axis_index_from_value(0, 0.941*<a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> local_diff, running_diff = 0.0, running_total = 0.0;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      <span class="comment">//Calculate the ~L^2 difference</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; padie_data.<a class="code" href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">get_dims</a>(0); i++){</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        local_diff = std::pow(padie_data.<a class="code" href="classmy__array.html#a65cea2b7cdb86a5cd01595c51b88e1c9">get_element</a>(i) - test_contr-&gt;get_current_d()-&gt;get_element(v_ind, i), 2);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        running_diff += local_diff;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        running_total += std::pow(padie_data.<a class="code" href="classmy__array.html#a65cea2b7cdb86a5cd01595c51b88e1c9">get_element</a>(i), 2);</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      }</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      test_bed-&gt;report_info(<span class="stringliteral">&quot;Calculated D has L2 mismatch of &quot;</span> + <a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((<span class="keywordtype">int</span>)(std::sqrt(running_diff/running_total)*100 ))+<span class="charliteral">&#39;%&#39;</span>);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="comment">//Very relaxed error condition</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      <span class="keywordflow">if</span>(std::sqrt(running_diff/running_total)*100 &gt; 50) err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    </div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    err |= TEST_ASSERT_FAIL;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  }</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;}</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<a class="code" href="classdata__array.html">data_array</a> test_entity_d::read_padie_data(<span class="keywordtype">bool</span> single_n, <span class="keywordtype">int</span> n, <span class="keywordtype">bool</span> use_d_pp){</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  std::string padie_dir = tests_src_dir + <span class="stringliteral">&quot;PadieTestData/&quot;</span>;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  std::string filestart = <span class="stringliteral">&quot;Data&quot;</span>;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  std::string fileend = <span class="stringliteral">&quot;&quot;</span>, filename;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <span class="keywordflow">if</span>(single_n){</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    fileend = <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    fileend += <a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(n);</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  }</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  filename = padie_dir + filestart + fileend;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="keywordflow">if</span>(use_d_pp) filename += <span class="stringliteral">&quot;_p.dat&quot;</span>;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="keywordflow">else</span> filename += <span class="stringliteral">&quot;.dat&quot;</span>;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Reading &quot;</span> + filename);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <a class="code" href="classdata__array.html">data_array</a> data = <a class="code" href="classdata__array.html">data_array</a>(filename);</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  </div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="keywordflow">return</span> data;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;}</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">//----------------------------------------------------------------</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;test_entity_bounce::test_entity_bounce(){</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  name = <span class="stringliteral">&quot;bounce averaging&quot;</span>;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  file_prefix = tests_src_dir;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">//Have to set-up deck constants before creating plasma</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <a class="code" href="group__main.html#ga6c1eed606f17752cde3184c9137764f0">get_deck_constants</a>(tests_src_dir + <span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  <a class="code" href="group__main.html#ga6a7867e1229358461bbc8d3b6e7f10ef">share_consts</a>();</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  test_contr = <span class="keyword">new</span> <a class="code" href="classcontroller.html">controller</a>(file_prefix);</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;}</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;test_entity_bounce::~test_entity_bounce(){</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <span class="keywordflow">if</span>(test_contr) <span class="keyword">delete</span> test_contr;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;}</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="keywordtype">int</span> test_entity_bounce::run(){</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="comment">//First we do a simple test by rigging up some space-blocked 1x1 D&#39;s containing value 1, This should return the length of the line which we calc using Eq 1.01 in Schulz/Lanzerotti and compare</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <a class="code" href="classbounce__av__data.html">bounce_av_data</a> bounce_dat;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  bounce_dat.<a class="code" href="classbounce__av__data.html#a8e17ffd776626d4c9545a93e8c631232">max_latitude</a> = 90.0;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  bounce_dat.<a class="code" href="classbounce__av__data.html#afbac0f828c95e3e9ee6818230970796a">L_shell</a> = 4.5;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> line_length;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  line_length = 2.7603/2.0 * bounce_dat.<a class="code" href="classbounce__av__data.html#afbac0f828c95e3e9ee6818230970796a">L_shell</a> * <a class="code" href="group__const.html#ga5b7bacfb02fa1ccb4e24a8b0c0f6903d">R_E</a>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Expecting line length of &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(line_length/1000.0)+<span class="stringliteral">&quot; km&quot;</span>);</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;32; n++){</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    test_contr-&gt;add_spectrum(1, 1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    test_contr-&gt;add_d(1, 1);</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    test_contr-&gt;get_current_d()-&gt;set_element((<span class="keywordtype">size_t</span>)0,(<span class="keywordtype">size_t</span>)0, 1.0);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  }</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  test_contr-&gt;bounce_average(bounce_dat);</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="comment">//These should match to within say 0.1% for a reasonable result</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  test_bed-&gt;report_info(<span class="stringliteral">&quot;Got line length &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(test_contr-&gt;get_special_d()-&gt;get_element((<span class="keywordtype">size_t</span>)0,(<span class="keywordtype">size_t</span>)0)/1000.0)+<span class="stringliteral">&quot; km&quot;</span>);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordflow">if</span>(std::abs(test_contr-&gt;get_special_d()-&gt;get_element((<span class="keywordtype">size_t</span>)0,(<span class="keywordtype">size_t</span>)0)/line_length - 1.0) &gt; 0.001){</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Line length mismatch of &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(std::abs(test_contr-&gt;get_special_d()-&gt;get_element((<span class="keywordtype">size_t</span>)0,(<span class="keywordtype">size_t</span>)0)/line_length - 1.0)*100.0, <span class="keyword">false</span>) +<span class="stringliteral">&quot; %&quot;</span>);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  }</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  </div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="comment">//Now we check over some of the helpers, mirror latitude, bounce period etc using a sample pitch angle and latitude</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> test_alpha_eq = 10.0*<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/180.0, expected_mirror_lat = 52, expected_bounce_period = 1.2, expected_alpha_at_lat_20 = 13, tmp;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  tmp = <a class="code" href="group__bounce.html#gaaf89171d02fe596acc8cc450057d05f6">solve_mirror_latitude</a>(test_alpha_eq)*180/<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordflow">if</span>(std::abs(tmp - expected_mirror_lat) &gt; 1.0){</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="comment">//Mirror lat to nearest degree</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Wrong mirror latitude, value &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp)+<span class="stringliteral">&quot; expected &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(expected_mirror_lat), 1);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  }</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  tmp = <a class="code" href="group__bounce.html#ga08b7ffc413ad39fa401bc0dcd0e232cb">bounce_period_approx</a>(test_alpha_eq);</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordflow">if</span>(std::abs(tmp - expected_bounce_period) &gt; 0.01){</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="comment">//Bounce period factor to 3 dp</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Wrong bounce period, value &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp)+<span class="stringliteral">&quot; expected &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(expected_bounce_period), 1);</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  }</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  tmp = <a class="code" href="group__bounce.html#ga6972a830c5a0425cbf074297ee80115b">alpha_from_alpha_eq</a>(test_alpha_eq, 20.0*<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/180.0)*180/<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="keywordflow">if</span>(std::abs(tmp - expected_alpha_at_lat_20) &gt; 1.0){</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="comment">//Pitch angle at lat 20 deg. to nearest degree</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    test_bed-&gt;report_info(<span class="stringliteral">&quot;Wrong pitch angle, value &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(tmp)+<span class="stringliteral">&quot; at latitude 20 degrees, expected &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>(expected_alpha_at_lat_20), 1);</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  }</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="keywordflow">if</span>(err == TEST_PASSED) test_bed-&gt;report_info(<span class="stringliteral">&quot;Bounce helpers OK&quot;</span>, 2);</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  </div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  bounce_dat.<a class="code" href="classbounce__av__data.html#a90e1c870e33bef93ebe40372f81bd077">type</a> = p_p;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  err |= bounce_cases(bounce_dat);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  bounce_dat.<a class="code" href="classbounce__av__data.html#a90e1c870e33bef93ebe40372f81bd077">type</a> = alpha_alpha;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  err |= bounce_cases(bounce_dat);</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  bounce_dat.<a class="code" href="classbounce__av__data.html#a90e1c870e33bef93ebe40372f81bd077">type</a> = alpha_p;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  err |= bounce_cases(bounce_dat);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;}</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="keywordtype">int</span> test_entity_bounce::bounce_cases(<a class="code" href="classbounce__av__data.html">bounce_av_data</a> bounce_dat){</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  test_contr-&gt;clear_all();</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keywordtype">size_t</span> d_sz =  150;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> val;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n=0; n&lt;32; n++){</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    test_contr-&gt;add_spectrum(1, 1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    test_contr-&gt;add_d(d_sz, d_sz);</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="comment">//Do axes</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt; d_sz; i++){</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j=0; j&lt; d_sz; j++){</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        <span class="keywordflow">switch</span>(bounce_dat.<a class="code" href="classbounce__av__data.html#a90e1c870e33bef93ebe40372f81bd077">type</a>){</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;          <span class="keywordflow">case</span> plain:</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            val = 0.0;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;          <span class="keywordflow">case</span> p_p:</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            val = cos(test_contr-&gt;get_current_d()-&gt;get_axis_element_ang(j));</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;          <span class="keywordflow">case</span> p_alpha:</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;          <span class="keywordflow">case</span> alpha_p:</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            val = 1.0/sin(test_contr-&gt;get_current_d()-&gt;get_axis_element_ang(j));</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            <span class="comment">//At zero we&#39;ll use any finite value because the numerator will be zero</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            <span class="keywordflow">if</span>(test_contr-&gt;get_current_d()-&gt;get_axis_element_ang(j) == 0.0) val = 1.0;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;          <span class="keywordflow">case</span> alpha_alpha:</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            val = 1.0/cos(test_contr-&gt;get_current_d()-&gt;get_axis_element_ang(j));</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        }</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        test_contr-&gt;get_current_d()-&gt;set_element(i,j, val);</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      }</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    }</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  }</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  test_contr-&gt;bounce_average(bounce_dat);</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="comment">//Check the value at random p and all angles</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  <a class="code" href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a> lambda_m, current_val, expected_val, alpha_eq;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  std::string err_string;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <span class="keywordtype">size_t</span> i = 10;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  <span class="comment">//Cheating and bumping down because at large initial pitch angles we get it wrong a bit</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment"></span>  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j=1; j&lt; d_sz; j++){</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    alpha_eq = test_contr-&gt;get_current_d()-&gt;get_axis_element_ang(j);</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    lambda_m = <a class="code" href="group__bounce.html#gaaf89171d02fe596acc8cc450057d05f6">solve_mirror_latitude</a>(alpha_eq);</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    current_val = test_contr-&gt;get_special_d()-&gt;get_element(i,j);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    </div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="keywordflow">switch</span>(bounce_dat.<a class="code" href="classbounce__av__data.html#a90e1c870e33bef93ebe40372f81bd077">type</a>){</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      <span class="keywordflow">case</span> plain:</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordflow">return</span> TEST_ASSERT_FAIL;<span class="comment">//Not meant to try this here</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      <span class="keywordflow">case</span> p_p:</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        expected_val =(3.0*sin(lambda_m)*std::sqrt(3.0*std::pow(sin(lambda_m), 2) + 1.0) + std::sqrt(3.0)*asinh(std::sqrt(3.0)*sin(lambda_m)))/6.0/<a class="code" href="group__bounce.html#ga08b7ffc413ad39fa401bc0dcd0e232cb">bounce_period_approx</a>(alpha_eq);</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        err_string = <span class="stringliteral">&quot;p_p&quot;</span>;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        <span class="keywordflow">if</span>(j &gt; d_sz - 12) err |= TEST_REMOVE_ERR;</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      <span class="keywordflow">case</span> p_alpha:</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      <span class="keywordflow">case</span> alpha_p:</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        expected_val = (1225.0*sin(lambda_m) + 245.0*sin(3.0*lambda_m) + 49.0*sin(5.0*lambda_m) + 5.0*sin(7.0*lambda_m))/2240.0/cos(alpha_eq)/sin(alpha_eq)/<a class="code" href="group__bounce.html#ga08b7ffc413ad39fa401bc0dcd0e232cb">bounce_period_approx</a>(alpha_eq);</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        err_string = <span class="stringliteral">&quot;alpha_p&quot;</span>;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        <span class="keywordflow">if</span>(j &lt; 12) err |= TEST_REMOVE_ERR;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      <span class="keywordflow">case</span> alpha_alpha:</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        expected_val = (1225.0*sin(lambda_m) + 245.0*sin(3.0*lambda_m) + 49.0*sin(5.0*lambda_m) + 5.0*sin(7.0*lambda_m))/2240.0/std::pow(cos(alpha_eq), 2)/<a class="code" href="group__bounce.html#ga08b7ffc413ad39fa401bc0dcd0e232cb">bounce_period_approx</a>(alpha_eq);</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        err_string = <span class="stringliteral">&quot;alpha_alpha&quot;</span>;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="keywordflow">if</span>(j &gt; d_sz - 12) err |= TEST_REMOVE_ERR;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    }</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <span class="keywordflow">if</span>(std::abs(current_val/expected_val -1.0) &gt; 0.05){</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      <span class="comment">//Moderate discrep allowed here</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="keywordflow">if</span>((err &amp; TEST_REMOVE_ERR) != TEST_REMOVE_ERR) test_bed-&gt;report_info(<span class="stringliteral">&quot;Erroneous bounce average in &quot;</span>+err_string+<span class="stringliteral">&quot; mismatch &quot;</span>+<a class="code" href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a>((<span class="keywordtype">int</span>)(std::abs(current_val/expected_val -1.0)*100))+<span class="charliteral">&#39;%&#39;</span>, 2);</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    }</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  }</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;}</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;test_entity_nonthermal::test_entity_nonthermal(){</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  name = <span class="stringliteral">&quot;nonthermal&quot;</span>;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;}</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="keywordtype">int</span> test_entity_nonthermal::run(){</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  </div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <span class="comment">//Setup single Max non-thermal</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <a class="code" href="classnon__thermal.html">non_thermal</a> * my_elec = <span class="keyword">new</span> <a class="code" href="classnon__thermal.html">non_thermal</a>(tests_src_dir + <span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> a_par = std::sqrt(2.0)*my_elec-&gt;get_v_par() / std::sqrt(1.0 - std::pow(my_elec-&gt;get_v_par()/<a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>, 2));</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> a_perp_sq = 2.0*std::pow(my_elec-&gt;get_v_perp(), 2)/(1.0 - 2.0*std::pow(my_elec-&gt;get_v_perp()/<a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>, 2));</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> norm = (my_elec-&gt;<a class="code" href="classnon__thermal.html#af1b39521d51b1bf861d83ada7700a6d6">get_total_dens</a>() - 1.0)/<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>/std::sqrt(<a class="code" href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a>)/a_par/a_perp_sq;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> df_tmp, f_tmp = my_elec-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(0, 0);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  </div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordflow">if</span>(std::abs(f_tmp / norm -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="group__growth__util.html#gad1270fc71258e8f92760a482f6a6fb70">n_trials</a> = 5;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> inc = 0.1, p_par, p_perp;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  <span class="comment">//Test f against expected values</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;n_trials*<a class="code" href="group__growth__util.html#gad1270fc71258e8f92760a482f6a6fb70">n_trials</a>; i++){</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    p_perp = inc* (i % <a class="code" href="group__growth__util.html#gad1270fc71258e8f92760a482f6a6fb70">n_trials</a>);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    p_par = inc* (int)(i/n_trials);</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    f_tmp = my_elec-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(p_par*a_par, p_perp*std::sqrt(a_perp_sq));</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordflow">if</span>(std::abs(f_tmp /( norm*std::exp(-p_par*p_par)*std::exp(-p_perp*p_perp)) -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  }</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="comment">//Test a couple of extreme cases</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  p_perp = 1.5;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  f_tmp = my_elec-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(p_par*a_par, p_perp*std::sqrt(a_perp_sq));</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <span class="keywordflow">if</span>(std::abs(f_tmp /( norm*std::exp(-p_par*p_par)*std::exp(-p_perp*p_perp)) -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  p_par = 2.5;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  f_tmp = my_elec-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(p_par*a_par, p_perp*std::sqrt(a_perp_sq));</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="keywordflow">if</span>(std::abs(f_tmp /( norm*std::exp(-p_par*p_par)*std::exp(-p_perp*p_perp)) -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="comment">//Test f against expected values</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;<a class="code" href="group__growth__util.html#gad1270fc71258e8f92760a482f6a6fb70">n_trials</a>; i++){</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    p_perp = inc*i + inc;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    p_par = inc*i + inc;</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="comment">//close to 0 deriv -&gt; 0</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    f_tmp = my_elec-&gt;<a class="code" href="classnon__thermal.html#a3fe174346a7f4acfcb6ea3112a793cb5">d_f_p</a>(p_par*a_par, 0, 1);</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">if</span>(std::abs(f_tmp /((-2.0)*p_par/a_par*my_elec-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(p_par*a_par, 0)) -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    f_tmp = my_elec-&gt;<a class="code" href="classnon__thermal.html#a3fe174346a7f4acfcb6ea3112a793cb5">d_f_p</a>(0, p_perp*std::sqrt(a_perp_sq), 0);</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordflow">if</span>(std::abs(f_tmp /((-2.0)*p_perp/std::sqrt(a_perp_sq)*my_elec-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(0, p_perp*std::sqrt(a_perp_sq))) -1.0) &gt; <a class="code" href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a>) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  }</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="comment">//This next is deep wings so we relax constraint so we&#39;re not trying to resolve 1e-60</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  df_tmp = my_elec-&gt;<a class="code" href="classnon__thermal.html#a3fe174346a7f4acfcb6ea3112a793cb5">d_f_p</a>(0, 10.0*std::sqrt(a_perp_sq), 0);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  <span class="keywordflow">if</span>(std::abs(df_tmp /((-2.0)*10.0/std::sqrt(a_perp_sq)*my_elec-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(0, 10.0*std::sqrt(a_perp_sq))) -1.0) &gt; 2e-6) err |=TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  </div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="keywordflow">if</span>(err == TEST_PASSED) test_bed-&gt;report_info(<span class="stringliteral">&quot;Nonthermal values OK&quot;</span>,1);</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  </div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  err |= test_lookup();</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;}</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="keywordtype">int</span> test_entity_nonthermal::test_lookup(){</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="keywordtype">int</span> err = TEST_PASSED;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  </div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <a class="code" href="classnon__thermal.html">non_thermal</a> * my_elec_an = <span class="keyword">new</span> <a class="code" href="classnon__thermal.html">non_thermal</a>(tests_src_dir + <span class="stringliteral">&quot;an&quot;</span>);</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <a class="code" href="classnon__thermal.html">non_thermal</a> * my_elec_lookup = <span class="keyword">new</span> <a class="code" href="classnon__thermal.html">non_thermal</a>(tests_src_dir + <span class="stringliteral">&quot;lookup&quot;</span>);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <a class="code" href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a> f_an, f_lookup, p_par, p_perp;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> n_tests = 100;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt; n_tests; i++){</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j=0; j&lt; n_tests; j++){</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      p_par = (float) i *<a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>/2.0/(<span class="keywordtype">float</span>) n_tests;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      p_perp = (float) j *<a class="code" href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a>/2.0/(<span class="keywordtype">float</span>) n_tests;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      f_an = my_elec_an-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(p_par, p_perp);</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      f_lookup = my_elec_lookup-&gt;<a class="code" href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">f_p</a>(p_par, p_perp);</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keywordflow">if</span>(std::abs(f_lookup/f_an - 1.0) &gt; LOW_PRECISION){</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        err |= TEST_WRONG_RESULT;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      }</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    }</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;  <span class="keywordflow">if</span>(err == TEST_PASSED) test_bed-&gt;report_info(<span class="stringliteral">&quot;Lookup OK&quot;</span>, 1);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;}</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="ttc" id="group__help_html_ga9c125e9455b3e1e14e28739de11287e5"><div class="ttname"><a href="group__help.html#ga9c125e9455b3e1e14e28739de11287e5">integrator</a></div><div class="ttdeci">T integrator(T *start, int len, T *increment)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00953">support.cpp:953</a></div></div>
<div class="ttc" id="classcontroller_html"><div class="ttname"><a href="classcontroller.html">controller</a></div><div class="ttdoc">Controls plasma, spectrum and d_coeff objects and their connections. </div><div class="ttdef"><b>Definition:</b> <a href="controller_8h_source.html#l00129">controller.h:129</a></div></div>
<div class="ttc" id="group__type_html_gaa6d335620eb2886edaffd3aae2ce1b02"><div class="ttname"><a href="group__type.html#gaa6d335620eb2886edaffd3aae2ce1b02">tiny_my_type</a></div><div class="ttdeci">const my_type tiny_my_type</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00035">support.h:35</a></div></div>
<div class="ttc" id="classnon__thermal_html_af1b39521d51b1bf861d83ada7700a6d6"><div class="ttname"><a href="classnon__thermal.html#af1b39521d51b1bf861d83ada7700a6d6">non_thermal::get_total_dens</a></div><div class="ttdeci">calc_type get_total_dens()</div><div class="ttdef"><b>Definition:</b> <a href="non__thermal_8h_source.html#l00064">non_thermal.h:64</a></div></div>
<div class="ttc" id="group__const_html_gaad263464e010fff1b9b275a68e8cc34a"><div class="ttname"><a href="group__const.html#gaad263464e010fff1b9b275a68e8cc34a">ANG_MAX</a></div><div class="ttdeci">const my_type ANG_MAX</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00120">support.h:120</a></div></div>
<div class="ttc" id="group__type_html_ga0f3d3a6e2c07b43705a3b4c4060c9d5b"><div class="ttname"><a href="group__type.html#ga0f3d3a6e2c07b43705a3b4c4060c9d5b">my_type</a></div><div class="ttdeci">#define my_type</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00031">support.h:31</a></div></div>
<div class="ttc" id="classbounce__av__data_html_a90e1c870e33bef93ebe40372f81bd077"><div class="ttname"><a href="classbounce__av__data.html#a90e1c870e33bef93ebe40372f81bd077">bounce_av_data::type</a></div><div class="ttdeci">bounce_av_type type</div><div class="ttdef"><b>Definition:</b> <a href="controller_8h_source.html#l00039">controller.h:39</a></div></div>
<div class="ttc" id="classnon__thermal_html_a3fe174346a7f4acfcb6ea3112a793cb5"><div class="ttname"><a href="classnon__thermal.html#a3fe174346a7f4acfcb6ea3112a793cb5">non_thermal::d_f_p</a></div><div class="ttdeci">calc_type d_f_p(calc_type p_par, calc_type p_perp, bool parallel)</div><div class="ttdef"><b>Definition:</b> <a href="non__thermal_8cpp_source.html#l00232">non_thermal.cpp:232</a></div></div>
<div class="ttc" id="classbounce__av__data_html_afbac0f828c95e3e9ee6818230970796a"><div class="ttname"><a href="classbounce__av__data.html#afbac0f828c95e3e9ee6818230970796a">bounce_av_data::L_shell</a></div><div class="ttdeci">my_type L_shell</div><div class="ttdef"><b>Definition:</b> <a href="controller_8h_source.html#l00040">controller.h:40</a></div></div>
<div class="ttc" id="group__const_html_ga7fd22b876a7035474236cd6ad36cd91e"><div class="ttname"><a href="group__const.html#ga7fd22b876a7035474236cd6ad36cd91e">v0</a></div><div class="ttdeci">const calc_type v0</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00071">support.h:71</a></div></div>
<div class="ttc" id="classplasma_html_aeb9d7e766639b4d61ce856e352386bc4"><div class="ttname"><a href="classplasma.html#aeb9d7e766639b4d61ce856e352386bc4">plasma::get_omega_ref</a></div><div class="ttdeci">calc_type get_omega_ref(std::string code) const </div><div class="ttdef"><b>Definition:</b> <a href="plasma_8cpp_source.html#l00162">plasma.cpp:162</a></div></div>
<div class="ttc" id="structmpi__info__struc_html_a8cfcb8992c29a52fe32b370b0d10e46b"><div class="ttname"><a href="structmpi__info__struc.html#a8cfcb8992c29a52fe32b370b0d10e46b">mpi_info_struc::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00152">support.h:152</a></div></div>
<div class="ttc" id="group__const_html_ga5b7bacfb02fa1ccb4e24a8b0c0f6903d"><div class="ttname"><a href="group__const.html#ga5b7bacfb02fa1ccb4e24a8b0c0f6903d">R_E</a></div><div class="ttdeci">const calc_type R_E</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00077">support.h:77</a></div></div>
<div class="ttc" id="structd__report_html_ac99c94c960788fe0b04bab8011ed38e4"><div class="ttname"><a href="structd__report.html#ac99c94c960788fe0b04bab8011ed38e4">d_report::n_av</a></div><div class="ttdeci">size_t n_av</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00207">support.h:207</a></div></div>
<div class="ttc" id="group__const_html_ga088f6f069df3ceb21e1ca47e227ebd66"><div class="ttname"><a href="group__const.html#ga088f6f069df3ceb21e1ca47e227ebd66">WAVE_O</a></div><div class="ttdeci">const int WAVE_O</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00086">support.h:86</a></div></div>
<div class="ttc" id="classplasma_html"><div class="ttname"><a href="classplasma.html">plasma</a></div><div class="ttdoc">Plasma parameters and dispersion. </div><div class="ttdef"><b>Definition:</b> <a href="plasma_8h_source.html#l00036">plasma.h:36</a></div></div>
<div class="ttc" id="group__bounce_html_gaaf89171d02fe596acc8cc450057d05f6"><div class="ttname"><a href="group__bounce.html#gaaf89171d02fe596acc8cc450057d05f6">solve_mirror_latitude</a></div><div class="ttdeci">my_type solve_mirror_latitude(my_type alpha_eq, bool print_iters)</div><div class="ttdef"><b>Definition:</b> <a href="controller_8cpp_source.html#l00428">controller.cpp:428</a></div></div>
<div class="ttc" id="group__main_html_gabbf945327481eed752399901fccfe617"><div class="ttname"><a href="group__main.html#gabbf945327481eed752399901fccfe617">get_ref_Bx</a></div><div class="ttdeci">my_type get_ref_Bx(std::string file_prefix, size_t space_in[2], size_t time_0)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00496">support.cpp:496</a></div></div>
<div class="ttc" id="structdeck__constants_html_a68a93a10e418b02ef9713e2b4543f9f8"><div class="ttname"><a href="structdeck__constants.html#a68a93a10e418b02ef9713e2b4543f9f8">deck_constants::omega_ce</a></div><div class="ttdeci">float omega_ce</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00139">support.h:139</a></div></div>
<div class="ttc" id="group__main_html_gac342126c26fa8d9b1f579f06ab064aa7"><div class="ttname"><a href="group__main.html#gac342126c26fa8d9b1f579f06ab064aa7">where</a></div><div class="ttdeci">int where(const my_type *ax_ptr, int len, my_type target)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00596">support.cpp:596</a></div></div>
<div class="ttc" id="group__spect_acc_html_ga495e5f5b91e2d5e35533ef53aa0be551"><div class="ttname"><a href="group__spect_acc.html#ga495e5f5b91e2d5e35533ef53aa0be551">spectrum::get_omega_length</a></div><div class="ttdeci">size_t get_omega_length() const </div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8h_source.html#l00186">spectrum.h:186</a></div></div>
<div class="ttc" id="group__spect_gs_html_gac4e945a80fc683805c6731103949f1fa"><div class="ttname"><a href="group__spect_gs.html#gac4e945a80fc683805c6731103949f1fa">get_G2</a></div><div class="ttdeci">calc_type get_G2(spectrum *my_spect, calc_type omega, calc_type x)</div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8cpp_source.html#l01275">spectrum.cpp:1275</a></div></div>
<div class="ttc" id="group__const_html_ga1d104cdff98408eb963e72bdd76454c3"><div class="ttname"><a href="group__const.html#ga1d104cdff98408eb963e72bdd76454c3">pi</a></div><div class="ttdeci">const calc_type pi</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00070">support.h:70</a></div></div>
<div class="ttc" id="group__const_html_gaf2ce0763f93e62b78eacb59c4c36f792"><div class="ttname"><a href="group__const.html#gaf2ce0763f93e62b78eacb59c4c36f792">WAVE_PLASMA</a></div><div class="ttdeci">const int WAVE_PLASMA</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00085">support.h:85</a></div></div>
<div class="ttc" id="structmu__dmudom_html_a496e24519eaef96aae56c2b8cb1e96ca"><div class="ttname"><a href="structmu__dmudom.html#a496e24519eaef96aae56c2b8cb1e96ca">mu_dmudom::mu</a></div><div class="ttdeci">calc_type mu</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00165">support.h:165</a></div></div>
<div class="ttc" id="classbounce__av__data_html"><div class="ttname"><a href="classbounce__av__data.html">bounce_av_data</a></div><div class="ttdoc">Bounce-averaging data. </div><div class="ttdef"><b>Definition:</b> <a href="controller_8h_source.html#l00034">controller.h:34</a></div></div>
<div class="ttc" id="classspectrum_html"><div class="ttname"><a href="classspectrum.html">spectrum</a></div><div class="ttdoc">A spectrum in omega and angle. </div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8h_source.html#l00029">spectrum.h:29</a></div></div>
<div class="ttc" id="group__spect_acc_html_gae358e8d750ff498b22023207cf9221fa"><div class="ttname"><a href="group__spect_acc.html#gae358e8d750ff498b22023207cf9221fa">spectrum::get_angle_length</a></div><div class="ttdeci">size_t get_angle_length() const </div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8h_source.html#l00185">spectrum.h:185</a></div></div>
<div class="ttc" id="classmy__array_html_a65cea2b7cdb86a5cd01595c51b88e1c9"><div class="ttname"><a href="classmy__array.html#a65cea2b7cdb86a5cd01595c51b88e1c9">my_array::get_element</a></div><div class="ttdeci">my_type get_element(size_t nx) const </div><div class="ttdef"><b>Definition:</b> <a href="my__array_8cpp_source.html#l00419">my_array.cpp:419</a></div></div>
<div class="ttc" id="structd__report_html_a0688c082333ab3edcfd3b22b09390430"><div class="ttname"><a href="structd__report.html#a0688c082333ab3edcfd3b22b09390430">d_report::single_n</a></div><div class="ttdeci">bool single_n</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00210">support.h:210</a></div></div>
<div class="ttc" id="structmu__dmudom_html"><div class="ttname"><a href="structmu__dmudom.html">mu_dmudom</a></div><div class="ttdoc">Reduced refractive index. </div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00164">support.h:164</a></div></div>
<div class="ttc" id="classreader_html"><div class="ttname"><a href="classreader.html">reader</a></div><div class="ttdoc">Reads SDF files into data_array. </div><div class="ttdef"><b>Definition:</b> <a href="reader_8h_source.html#l00025">reader.h:25</a></div></div>
<div class="ttc" id="classspectrum_html_a4e405518424b3e9f3e605903feea65e5"><div class="ttname"><a href="classspectrum.html#a4e405518424b3e9f3e605903feea65e5">spectrum::get_g_is_angle_only</a></div><div class="ttdeci">bool get_g_is_angle_only()</div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8h_source.html#l00091">spectrum.h:91</a></div></div>
<div class="ttc" id="group__type_html_gad5403a5111c18f5f42fadde6157a5728"><div class="ttname"><a href="group__type.html#gad5403a5111c18f5f42fadde6157a5728">calc_type</a></div><div class="ttdeci">#define calc_type</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00049">support.h:49</a></div></div>
<div class="ttc" id="group__spect_gs_html_ga17ae0551b8817506f21e6e341cae0eba"><div class="ttname"><a href="group__spect_gs.html#ga17ae0551b8817506f21e6e341cae0eba">get_G1</a></div><div class="ttdeci">calc_type get_G1(spectrum *my_spect, calc_type omega)</div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8cpp_source.html#l01236">spectrum.cpp:1236</a></div></div>
<div class="ttc" id="classbounce__av__data_html_a8e17ffd776626d4c9545a93e8c631232"><div class="ttname"><a href="classbounce__av__data.html#a8e17ffd776626d4c9545a93e8c631232">bounce_av_data::max_latitude</a></div><div class="ttdeci">my_type max_latitude</div><div class="ttdef"><b>Definition:</b> <a href="controller_8h_source.html#l00041">controller.h:41</a></div></div>
<div class="ttc" id="classnon__thermal_html_a03d465094276a339988a5aff7f79b3dd"><div class="ttname"><a href="classnon__thermal.html#a03d465094276a339988a5aff7f79b3dd">non_thermal::f_p</a></div><div class="ttdeci">calc_type f_p(calc_type p_par, calc_type p_perp)</div><div class="ttdef"><b>Definition:</b> <a href="non__thermal_8cpp_source.html#l00247">non_thermal.cpp:247</a></div></div>
<div class="ttc" id="structd__report_html"><div class="ttname"><a href="structd__report.html">d_report</a></div><div class="ttdoc">D coefficient report. </div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00205">support.h:205</a></div></div>
<div class="ttc" id="group__bounce_html_ga08b7ffc413ad39fa401bc0dcd0e232cb"><div class="ttname"><a href="group__bounce.html#ga08b7ffc413ad39fa401bc0dcd0e232cb">bounce_period_approx</a></div><div class="ttdeci">my_type bounce_period_approx(my_type alpha_eq)</div><div class="ttdef"><b>Definition:</b> <a href="controller_8h_source.html#l00097">controller.h:97</a></div></div>
<div class="ttc" id="group__main_html_ga6c1eed606f17752cde3184c9137764f0"><div class="ttname"><a href="group__main.html#ga6c1eed606f17752cde3184c9137764f0">get_deck_constants</a></div><div class="ttdeci">void get_deck_constants(std::string file_prefix)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00086">support.cpp:86</a></div></div>
<div class="ttc" id="group__const_html_gaa31bcf8bf35e2cf75bba00e230ab2209"><div class="ttname"><a href="group__const.html#gaa31bcf8bf35e2cf75bba00e230ab2209">WAVE_WHISTLER</a></div><div class="ttdeci">const int WAVE_WHISTLER</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00084">support.h:84</a></div></div>
<div class="ttc" id="classnon__thermal_html"><div class="ttname"><a href="classnon__thermal.html">non_thermal</a></div><div class="ttdoc">Nonthermal electron description. </div><div class="ttdef"><b>Definition:</b> <a href="non__thermal_8h_source.html#l00038">non_thermal.h:38</a></div></div>
<div class="ttc" id="group__const_html_gaa96713a7e2a9078df4dbdf2d604fe12b"><div class="ttname"><a href="group__const.html#gaa96713a7e2a9078df4dbdf2d604fe12b">DEFAULT_SPECTRUM_ANG_STDDEV</a></div><div class="ttdeci">const my_type DEFAULT_SPECTRUM_ANG_STDDEV</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00121">support.h:121</a></div></div>
<div class="ttc" id="structmu__dmudom_html_aa305dea66f8fee9be94f45a5d626d2f4"><div class="ttname"><a href="structmu__dmudom.html#aa305dea66f8fee9be94f45a5d626d2f4">mu_dmudom::dmudtheta</a></div><div class="ttdeci">calc_type dmudtheta</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00167">support.h:167</a></div></div>
<div class="ttc" id="structmu__dmudom_html_a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d"><div class="ttname"><a href="structmu__dmudom.html#a5e4f36e02fb9fc4a6e5ead4ee6fc1d2d">mu_dmudom::phi</a></div><div class="ttdeci">calc_type phi</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00168">support.h:168</a></div></div>
<div class="ttc" id="group__help_html_ga4400449ae193f353b2d9012e9b8c50f4"><div class="ttname"><a href="group__help.html#ga4400449ae193f353b2d9012e9b8c50f4">my_error_print</a></div><div class="ttdeci">void my_error_print(std::string text, int rank, int rank_to_write, bool noreturn)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00724">support.cpp:724</a></div></div>
<div class="ttc" id="group__help_html_ga98982a0c59613e879fb7b780eee46bba"><div class="ttname"><a href="group__help.html#ga98982a0c59613e879fb7b780eee46bba">mk_str</a></div><div class="ttdeci">std::string mk_str(int i)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00762">support.cpp:762</a></div></div>
<div class="ttc" id="structmu__dmudom_html_adb05c28e460513549326313a87675bae"><div class="ttname"><a href="structmu__dmudom.html#adb05c28e460513549326313a87675bae">mu_dmudom::err</a></div><div class="ttdeci">int err</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00169">support.h:169</a></div></div>
<div class="ttc" id="group__growth__util_html_gad1270fc71258e8f92760a482f6a6fb70"><div class="ttname"><a href="group__growth__util.html#gad1270fc71258e8f92760a482f6a6fb70">n_trials</a></div><div class="ttdeci">const int n_trials</div><div class="ttdef"><b>Definition:</b> <a href="calculate__growth_8cpp_source.html#l00032">calculate_growth.cpp:32</a></div></div>
<div class="ttc" id="group__const_html_ga35106e42f2f1e8a924add6e3e2d5511d"><div class="ttname"><a href="group__const.html#ga35106e42f2f1e8a924add6e3e2d5511d">FUNCTION_ISO</a></div><div class="ttdeci">const int FUNCTION_ISO</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00093">support.h:93</a></div></div>
<div class="ttc" id="group__const_html_gaee346054cefa8833f52d7562cb54be70"><div class="ttname"><a href="group__const.html#gaee346054cefa8833f52d7562cb54be70">ANG_MIN</a></div><div class="ttdeci">const my_type ANG_MIN</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00119">support.h:119</a></div></div>
<div class="ttc" id="group__const_html_ga3a65933f8b2c375c79e3025ddf0736fb"><div class="ttname"><a href="group__const.html#ga3a65933f8b2c375c79e3025ddf0736fb">TAN_MAX</a></div><div class="ttdeci">const my_type TAN_MAX</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00118">support.h:118</a></div></div>
<div class="ttc" id="group__main_html_ga6a7867e1229358461bbc8d3b6e7f10ef"><div class="ttname"><a href="group__main.html#ga6a7867e1229358461bbc8d3b6e7f10ef">share_consts</a></div><div class="ttdeci">void share_consts()</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00057">support.cpp:57</a></div></div>
<div class="ttc" id="classcontroller_html_ab41dac6ef7a39184b45b03287c15394e"><div class="ttname"><a href="classcontroller.html#ab41dac6ef7a39184b45b03287c15394e">controller::get_plasma</a></div><div class="ttdeci">const plasma &amp; get_plasma()</div><div class="ttdef"><b>Definition:</b> <a href="controller_8h_source.html#l00164">controller.h:164</a></div></div>
<div class="ttc" id="group__main_html_ga689ada8162b91051964231de819f267b"><div class="ttname"><a href="group__main.html#ga689ada8162b91051964231de819f267b">gamma_rel</a></div><div class="ttdeci">calc_type gamma_rel(calc_type v)</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00257">support.h:257</a></div></div>
<div class="ttc" id="classdata__array_html_addf2c1b94dff445a2e7ca4a3cc258ea0"><div class="ttname"><a href="classdata__array.html#addf2c1b94dff445a2e7ca4a3cc258ea0">data_array::is_good</a></div><div class="ttdeci">virtual bool is_good() const </div><div class="ttdef"><b>Definition:</b> <a href="data__array_8h_source.html#l00052">data_array.h:52</a></div></div>
<div class="ttc" id="classmy__array_html_a399815441ab623aa0b98aa390be56f4f"><div class="ttname"><a href="classmy__array.html#a399815441ab623aa0b98aa390be56f4f">my_array::get_dims</a></div><div class="ttdeci">size_t get_dims() const </div><div class="ttdef"><b>Definition:</b> <a href="my__array_8cpp_source.html#l00265">my_array.cpp:265</a></div></div>
<div class="ttc" id="group__const_html_gac02e3a5dfd38d22ccf714b333742458e"><div class="ttname"><a href="group__const.html#gac02e3a5dfd38d22ccf714b333742458e">GEN_PRECISION</a></div><div class="ttdeci">const calc_type GEN_PRECISION</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00079">support.h:79</a></div></div>
<div class="ttc" id="group__const_html_gaddeb0aec55e5cc252db1a24d8b33995d"><div class="ttname"><a href="group__const.html#gaddeb0aec55e5cc252db1a24d8b33995d">DEFAULT_N_ANG</a></div><div class="ttdeci">const int DEFAULT_N_ANG</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00081">support.h:81</a></div></div>
<div class="ttc" id="structd__report_html_ab689de1ad055c221d20cc4a2002139ee"><div class="ttname"><a href="structd__report.html#ab689de1ad055c221d20cc4a2002139ee">d_report::n_max</a></div><div class="ttdeci">size_t n_max</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00208">support.h:208</a></div></div>
<div class="ttc" id="classdata__array_html"><div class="ttname"><a href="classdata__array.html">data_array</a></div><div class="ttdoc">Extended my_array class including axes. </div><div class="ttdef"><b>Definition:</b> <a href="data__array_8h_source.html#l00025">data_array.h:25</a></div></div>
<div class="ttc" id="group__spect_acc_html_gaca5a1984d6f7b4ec3eb22f002d8ca9aa"><div class="ttname"><a href="group__spect_acc.html#gaca5a1984d6f7b4ec3eb22f002d8ca9aa">spectrum::set_g_element</a></div><div class="ttdeci">void set_g_element(size_t n_ang, my_type val)</div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8h_source.html#l00169">spectrum.h:169</a></div></div>
<div class="ttc" id="group__str_html_gac15fa2bad2324428e4f11544709ab4b3"><div class="ttname"><a href="group__str.html#gac15fa2bad2324428e4f11544709ab4b3">my_const</a></div><div class="ttdeci">deck_constants my_const</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00023">support.cpp:23</a></div></div>
<div class="ttc" id="structmu__dmudom_html_a2530bc728d44b3fb7f98857c2730835b"><div class="ttname"><a href="structmu__dmudom.html#a2530bc728d44b3fb7f98857c2730835b">mu_dmudom::dmudom</a></div><div class="ttdeci">calc_type dmudom</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00166">support.h:166</a></div></div>
<div class="ttc" id="group__const_html_ga518db694e7101247d80fee2079e31868"><div class="ttname"><a href="group__const.html#ga518db694e7101247d80fee2079e31868">FUNCTION_DELTA</a></div><div class="ttdeci">const int FUNCTION_DELTA</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00091">support.h:91</a></div></div>
<div class="ttc" id="group__help_html_gab9d50e3f67f2510d4560b31729ef7198"><div class="ttname"><a href="group__help.html#gab9d50e3f67f2510d4560b31729ef7198">append_into_string</a></div><div class="ttdeci">std::string append_into_string(const std::string &amp;in, const std::string &amp;infix)</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00859">support.cpp:859</a></div></div>
<div class="ttc" id="group__bounce_html_ga6972a830c5a0425cbf074297ee80115b"><div class="ttname"><a href="group__bounce.html#ga6972a830c5a0425cbf074297ee80115b">alpha_from_alpha_eq</a></div><div class="ttdeci">my_type alpha_from_alpha_eq(my_type alpha_eq, my_type lat)</div><div class="ttdef"><b>Definition:</b> <a href="controller_8h_source.html#l00114">controller.h:114</a></div></div>
<div class="ttc" id="group__const_html_ga0cd3734ef3169bd6835352228d01150a"><div class="ttname"><a href="group__const.html#ga0cd3734ef3169bd6835352228d01150a">WAVE_X_LOW</a></div><div class="ttdeci">const int WAVE_X_LOW</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00088">support.h:88</a></div></div>
<div class="ttc" id="structdeck__constants_html"><div class="ttname"><a href="structdeck__constants.html">deck_constants</a></div><div class="ttdoc">Constants read from deck. </div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00136">support.h:136</a></div></div>
<div class="ttc" id="group__str_html_gae617c689379826c6aa48a91868bf97c5"><div class="ttname"><a href="group__str.html#gae617c689379826c6aa48a91868bf97c5">mpi_info</a></div><div class="ttdeci">mpi_info_struc mpi_info</div><div class="ttdef"><b>Definition:</b> <a href="support_8cpp_source.html#l00021">support.cpp:21</a></div></div>
<div class="ttc" id="group__spect_acc_html_ga9e736f31959430cbef0a6b2a01e36161"><div class="ttname"><a href="group__spect_acc.html#ga9e736f31959430cbef0a6b2a01e36161">spectrum::set_B_element</a></div><div class="ttdeci">void set_B_element(size_t n_om, my_type val)</div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8h_source.html#l00168">spectrum.h:168</a></div></div>
<div class="ttc" id="group__const_html_ga32f0cbb8e2b7d5a957a71446c467d6ab"><div class="ttname"><a href="group__const.html#ga32f0cbb8e2b7d5a957a71446c467d6ab">FUNCTION_GAUSS</a></div><div class="ttdeci">const int FUNCTION_GAUSS</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00092">support.h:92</a></div></div>
<div class="ttc" id="structd__report_html_aabb53ca65e3c0c3ee800faf98905d6d0"><div class="ttname"><a href="structd__report.html#aabb53ca65e3c0c3ee800faf98905d6d0">d_report::error</a></div><div class="ttdeci">bool error</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00206">support.h:206</a></div></div>
<div class="ttc" id="group__spect_acc_html_gacac016090ac42d512b198d4f3bcb7b9d"><div class="ttname"><a href="group__spect_acc.html#gacac016090ac42d512b198d4f3bcb7b9d">spectrum::get_g_element</a></div><div class="ttdeci">my_type get_g_element(size_t n_ang) const </div><div class="ttdef"><b>Definition:</b> <a href="spectrum_8h_source.html#l00165">spectrum.h:165</a></div></div>
<div class="ttc" id="group__const_html_ga2969bfa057f2ab3bc51e24503a978e6d"><div class="ttname"><a href="group__const.html#ga2969bfa057f2ab3bc51e24503a978e6d">WAVE_X_UP</a></div><div class="ttdeci">const int WAVE_X_UP</div><div class="ttdef"><b>Definition:</b> <a href="support_8h_source.html#l00087">support.h:87</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 6 2017 10:31:50 for WIPPS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
